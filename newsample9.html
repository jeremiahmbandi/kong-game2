<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale: 1.0, maximum-scale: 1.0, user-scalable: no">
    <title>Kong (Treasure Hunt) Slot Machine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Andada+Pro:ital,wght@0,400..840;1,400..840&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Victor+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="service.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #2c2c2c;
            touch-action: manipulation;
            font-family: 'Victor Mono', monospace;
            font-optical-sizing: auto;
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'aldo';
            src: url('aldo_the_apache') format('truetype');
        }

        #game-container {
            width: 100%;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'aldo', sans-serif;
        }
        .game-canvas-container {
            flex: 1;
            position: relative;
            height: 100%;
            width: 100%;
            margin: auto;
            overflow: hidden;
            z-index: 888;
        }
        .game-controls {
            margin: 0px !important;
            padding: 0px !important;
            width: 100%;
            background-image: url('wood.jpg');
            z-index: 1000;
            bottom: 0 !important;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .spin-button, .autoplay-button {
            cursor: pointer;
            width: 100%;
            text-align: center;
            padding: 12px;
        }
        /* Responsive adjustments */
        @media (max-height: 600px) {
            .game-controls {
                padding: 5px;
            }
            .control-group {
                gap: 5px;
            }
            .input-group {
                margin-bottom: 5px;
            }
        }
        /* Prevent text selection */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Allow input in number fields */
        input[type="number"] {
            -webkit-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }
        #jdb_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 2002;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #kong_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('kong_bcg4.png');
            background-size: cover;
            background-repeat: repeat;
            background-color: black;
            z-index: 2001;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        /* Stake button and overlay styles */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 1);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .overlay-content {
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            margin-top: 100px;
        }
        .overlay-content-stake {
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            padding: 20px;
            margin-top: 100px;
        }
        .overlay-header {
            color: #e4d594;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .option-button {
            background: linear-gradient(to bottom, #353333, #272525);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 0;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-button:hover, .option-button.selected {
            background-color: #25282b;
            box-shadow: 
                inset 0 0 0 2px rgba(0, 0, 0, 0.15),
                0 0 0 2px rgba(0, 0, 0, 0.15),
                inset 0 0 0.875rem #FCEAAC,
                0 0 0.875rem #FCEAAC;
        }
        .overlay-footer {
            width: inherit;
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-bottom: 50px;
            bottom: 0;
            position: absolute;
        }
        .overlay-footer-stake {
            margin-top: 20px;
            padding-bottom: 50px;
            bottom: 0;
            position: absolute;
        }
        .overlay-footer button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        .cancel-button {
            background-color: #333;
            color: white;
        }
        .confirm-button {
            background-color: #333;
            box-shadow: 0 0 4px #e4d594;
            color: white;
        }
        .divider-container {
            color: #e4d594;
        }
        .divider {
            height: 2px;
            background-color: #e4d594;
            width: 30vw;
        }
        .divider-text {
            margin: 0 10px;
        }
        .divider-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin: 16px 0;
        }
        .check-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 4px;
            position: relative;
        }
        .check-icon:before {
            content: '';
            position: absolute;
            width: 8px;
            height: 12px;
            border-right: 2px solid white;
            border-bottom: 2px solid white;
            transform: rotate(45deg);
            top: 0;
            left: 4px;
        }
        
        .victor-mono {
            font-family: "Victor Mono", monospace;
            font-optical-sizing: auto;
            font-weight: normal;
            font-style: normal;
        }

        /* Settings overlay styles */
        .sound-option {
            color: white;
        }
        .icon-container {
            font-size: 1.5rem;
            display: inline-block;
            width: 30px;
            text-align: center;
        }
        .loader-container {
            height: 10px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        .loader-bar {
            height: 100%;
            width: 0;
            transition: width 0.3s ease;
        }
        .glowing-button {
            position: absolute; /* Ensure ::after is positioned relative to this */
            bottom: 9%;
            padding: 6px 50px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            border-radius: 12px;
            border-width: 5px;
            border-style: solid;
            border-color: #c09c0e;
            background-color: #fada60;
            font-weight: bold;
            text-shadow: 
                -1px -1px 0 orange,  
                1px -1px 0 orange,
                -1px  1px 0 orange,
                1px  1px 0 orange;
            overflow: hidden; /* Prevents the light effect from overflowing */
        }

        /* Light reflection effect */
        .glowing-button::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%; /* Reduce width to prevent excessive overflow */
            height: 100%;
            background: linear-gradient(
                100deg,
                rgba(255, 255, 255, 0) 40%,
                rgba(255, 255, 255, 0.4) 50%,
                rgba(255, 255, 255, 0) 60%
            );
            animation: light-sweep 2s infinite linear;
        }

        @keyframes light-sweep {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Free spins indicator */
        .free-spins-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(192, 156, 14, 0.8);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.0rem;
            font-weight: bold;
            z-index: 100;
            display: none;
        }

        /* Win message */
        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fada60;
            padding: 15px 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            animation: bounce 1s infinite;
            z-index: 100;
            display: none;
        }

        .mobile-wrapper {
            max-width: 100vw;
            max-height: 100vh;
        }
        .autoplay-button, .stake-button{
            height: 70px;
            width: 70px;
        }
        .spin-img{
            height: 55px;
            width: 55px;
        }
        .spin-button{
            height: 85px;
            width: 85px;
        }
        .autospininner-img{
            height: 35px;
            width: 35px;
        }
        .autospininnerimgstop{
            height: 25px;
            width: 25px;
        }
        .totalbetinner-img{
            height: 25px;
        }
        .current-stake{
            font-size: 1.2rem;
            color: #f6d64e;
        }
        #playground{
            height: 40vh;
        }
        .fs-text-image{
            max-height: 25px;
        }
        #remaining_fs_holder, #total_fs_holder{
            color: #8cc904;
            font-size: 2.0rem;
            font-weight: bold;
        }

        @media screen and (min-width: 900px) {
            .sunburst-container {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 80vw;
                max-width: 600px;
                height: 80vw;
                max-height: 600px;
                z-index: 10; /* Higher than coins */
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: visible;
                pointer-events: none;
            }
            #jdb_overlay {
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-color: black;
                z-index: 2002;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            #kong_overlay {
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-image: url('kong_bcg5.png');
                background-size: contain;
                background-repeat: no-repeat;
                background-color: black;
                z-index: 2001;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            .overlay {
                position: absolute;
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-color: rgba(0, 0, 0, 1);
                z-index: 2000;
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            #playground{
                max-height: 200px;
                width: 100%;
            }
            .mobile-wrapper {
                max-width: 320px;
                max-height: 490px;
            }
            .autoplay-button, .stake-button{
                height: 55px;
                width: 55px;
            }
            .spin-img{
                height: 45px;
                width: 45px;
            }
            .spin-button{
                height: 70px;
                width: 70px;
            }
            .autospininner-img{
                height: 30px;
                width: 30px;
            }
            .autospininnerimgstop{
                height: 25px;
                width: 25px;
            }
            .totalbetinner-img{
                height: 21px
            }
            .current-stake{
                font-size: 1.0rem;
                color: #f6d64e;
            }
            .fs-text-image{
                max-height: 20px;
            }
            #remaining_fs_holder, #total_fs_holder{
                color: #8cc904;
                font-size: 1.5rem;
                font-weight: bold;
            }
        }

        .btn-gold {
            background-color: #b8860b;
            color: white;
            border: none;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-gold:hover {
            background-color: #a67c00;
            color: white;
        }

        #winOverlay{
            position: absolute;
            width: 100%;
            min-height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #closeBtn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            z-index: 20;
        }

        .win-content {
            position: relative;
            text-align: center;
            z-index: 15;
        }

        /* Rotating sunburst effect */
        .sunburst-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            max-width: 600px;
            height: 80vw;
            max-height: 600px;
            z-index: 10; /* Higher than coins */
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible;
            pointer-events: none;
        }

        .sunburst {
            width: 100%;
            height: 100%;
            background-image: url('https://hebbkx1anhila5yf.public.blob.vercel-storage.com/BigWin_FX-pnFZvgsE0rjtfTiTODDEY1oM6AHQJ4.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            animation: rotate 10s linear infinite;
        }

        /* Colored overlays for different win levels */
        .big-win-color {
            filter: none;
        }

        .mega-win-color {
            filter: none; /* Original gold/yellow color */
        }

        .ultra-win-color {
            filter: none;
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .win-text {
            font-size: calc(2rem + 2vw);
            font-weight: bold;
            margin-bottom: 16px;
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
            animation: text-flicker 2s infinite;
            transition: color 0.5s, transform 0.5s;
            position: relative;
            z-index: 20;
        }

        .counter-text {
            font-size: calc(0.5rem + 2vw);
            font-weight: bold;
            color: #a67c00;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 1.5s infinite;
            position: relative;
            z-index: 20;
        }

        #coinsContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 5; /* Lower than sunburst */
        }

        .coin {
            position: absolute;
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.7));
            transition: transform 0.05s ease-out;
            z-index: 5; /* Lower than sunburst */
        }

        /* Win level styles */
        .big-win {
            color: #ffd700;
        }

        .mega-win {
            color: #ffd700;
        }

        .ultra-win {
            color: #ffd700;
        }

        @keyframes text-flicker {
            0%, 100% {
                opacity: 1;
                text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
            }
            50% {
                opacity: 0.9;
                text-shadow: 0 0 15px currentColor, 0 0 25px currentColor;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        @keyframes scale-in {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .scale-in {
            animation: scale-in 0.5s forwards;
        }

        /* Game info overlay */
        #gameinfo_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 2002;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: auto;
            display: none;
        }

        /* Features overlay */
        #featuresOverlay {
            display: none;
            z-index: 9999;
            position: absolute;
            height: 100%;
            width: 100%;
            background-color: rgb(0,0,0,0.8);
        }

        /* Device overlay */
        #device_overlay {
            display: none;
        }

        /* Free spins overlay */
        #freespinsoverlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.8);
            height: 100%;
            width: 100%;
            z-index: 999999;
        }

        /* Start free spins overlay */
        #startfreespinsoverlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            z-index: 999999;
        }

        /* Canvas styles */
        canvas {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="w-100">
<div style="background-image: url('page_bcg.png'); background-size: cover; height: 100vh; padding: 0 !important;">
    <div style="z-index: 3; position: absolute;">
        <button id="featuresButton" class="btn btn-warning mt-5 mb-2 mx-3">
            Feature
        </button>
    </div>
    <div id="featuresOverlay">
       <div style="height: 100%; width: 100%; font-weight: bold;" class="d-flex justify-content-center align-items-center">
            <div class="mx-auto">
                <div class="mx-auto">
                    <button onclick="setDemoFeature('big spin')" class="btn btn-warning btn-lg my-2 mb-2 mx-3">
                        Feature 1
                    </button>
                </div>
                <div class="mx-auto">
                    <button onclick="setDemoFeature('big win')" class="btn btn-warning btn-lg my-2 mx-3">
                        Feature 2
                    </button>
                </div>
                <div class="mx-auto">
                    <button onclick="setDemoFeature('free spins')" class="btn btn-warning btn-lg my-2 mb-2 mx-3">
                        Feature 3
                    </button>
                </div>
            </div>
       </div>
    </div>

    <div class="mobile-wrapper mx-auto">

        <div id="gameinfo_overlay" class="overlay" style="max-height: 100vh !important;overflow-y: scroll;overflow-x: hidden;">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider-text h3">GAME RULE</div>
                </div>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <div style="width: 90%;background-color: #e4d594;height: 5px;"></div>
            </div>
            <div class="" style="color: white;">
                <div style="border: 1px;border-color: #e4d594;font-size: 1.0rem;border-style: solid;" class="py-4 mx-3 d-flex justify-content-center align-items-around my-3">
                    <div class="px-2">
                        <span style="color: #e4d594;"> Denomination:</span> 0.01
                    </div>
                    <div class="px-2">
                        <span style="color: #e4d594;">Bet Multiplier:</span> 1
                    </div>
                </div>
                <div class="row px-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4" style="font-weight: bold;">
                        <img src="wild.png" style="max-width: 100px;" alt="">
                        <div class="h3">WILD</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12" style="font-weight: bold;">
                        ONLY APPEARS ON REELS 2,3,4 AND 5.
                        <br>
                        <br>
                        <div class="d-flex justify-content-start align-items-center">
                            SUBSTITUTES FOR ALL SYMBOLS EXCEPT <img style="width: 40px;height: auto;" src="scatter.png" alt="">
                        </div>
                    </div>
                </div>
    
    
                <div class="row px-3 my-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4 mb-3">
                        <img src="scatter.png" style="max-width: 100px;" alt="">
                        <div class="h3">FREE SPIN BONUS</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12" style="font-weight: bold;">
                        APPEARS ON ALL REELS
                        <br>
                        <div class="">
                            IF ATLEAST ONE <img style="width: 40px;height: auto;" src="scatter.png" alt=""> APPEARS ON ALL REELS FREE SPIN BONUS WITH 13 FREE SPINS AND A BONUS MULTIPLIER WILL BE TRIGGERED 
                        </div>
    
                        <div class="mt-4">
                            <div class="my-1">
                                5 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 3X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                6 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 6X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                7 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 12X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                8 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 24X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                9 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 36X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                10 <img style="width: 40px;height: auto;" class="px-1" src="scatter.png" alt=""> AWARD 72X BONUS MULTIPLIER
                            </div>
                        </div>
                    </div>
                </div>
    
                <div class="divider-container">
                    <div class="divider-wrapper">
                        <div class="divider-text h2" style="font-weight: bold;" >PAYTABLE</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
    
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="treasurechest.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 250
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 40
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="explorer.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 200
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 30
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="compass.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 175
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 60
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 25
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="binoculars.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 150
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 50
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 20
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="a.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 20
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 10
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="k.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 90
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 15
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 8
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="q.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 12
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 6
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="j.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 70
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 10
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 5
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2" style="visibility: hidden;">
                        
                    </div>
                </div>
    
                <div style="font-size: 1.0rem;" class="text-center">
                    <div class="my-1">
                        ALL WINS PAY LEFTMOST TO RIGHT, EXCEPT <img src="scatter.png" style="max-width: 40px;" alt="">
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN FOR BET MULTIPLIER X1.
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN IN CREDITS
                    </div>
                </div>
    
                <div class="divider-container mt-5">
                    <div class="divider-wrapper">
                        <div class="divider-text h2" style="font-weight: bold;">FREE SPIN BONUS</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
                
    
                <div style="font-size: 1.0rem;border: 1px;border-style: solid;border-color: white;" class="px-4 my-3 mx-3 py-2">
                    IF AT LEAST ONE <img style="max-width: 40px;" src="scatter.png" alt=""> APPEARS ON EACH REEL, ADDITIONAL 13 FREE SPINS ARE AWARDED, TO A MAXIMUM OF 100 FREE SPINS IN A SINGLE BOUGHT GAME. RETRIGGER OF FREE SPIN BONUS WILL NOT CHANGE THE BONUS MULTIPLIER OF THE FREE SPIN BONUS. 
                    <br>
                    DURING FREE SPIN BONUS, THE WINS ARE MULTIPLIED BY THE BONUS MULTIPLIER AND ADDED TO THE WIN METER
                </div>
    
                <div style="border: 1px;border-color: #e4d594;font-size: 1.0rem;border-style: solid;" class="py-4 mx-3 d-flex justify-content-center align-items-around my-3">
                    <div class="px-2">
                        <span style="color: #e4d594;"> Denomination:</span> 0.01
                    </div>
                    <div class="px-2">
                        <span style="color: #e4d594;">Bet Multiplier:</span> 1
                    </div>
                </div>

                <div class="row px-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4" style="font-weight: bold;">
                        <img src="wild.png" style="max-width: 100px;" alt="">
                        <div class="h3">WILD</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12" style="font-weight: bold;">
                        ONLY APPEARS ON REELS 2,3,4 AND 5.
                        <br>
                        <br>
                        <div class="d-flex justify-content-start align-items-center">
                            SUBSTITUTES FOR ALL SYMBOLS EXCEPT <img style="width: 40px;height: auto;" src="scatter.png" alt="">
                        </div>
                    </div>
                </div>

                <div class="row px-3 my-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4 mb-3">
                        <img src="scatter.png" style="max-width: 100px;" alt="">
                        <div class="h3">FREE SPIN BONUS</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12" style="font-weight: bold;">
                        APPEARS ON ALL REELS
                    </div>
                </div>
    
    
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="treasurechest.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 250
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 40
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="explorer.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 200
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 30
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="compass.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 175
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 60
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 25
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="binoculars.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 150
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 50
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 20
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="a.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 20
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 10
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="k.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 90
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 15
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 8
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.1rem;font-weight: bold;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="q.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 12
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 6
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="j.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 70
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 10
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 5
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2" style="visibility: hidden;">
                        
                    </div>
                </div>
    
                <div style="font-size: 1.0rem;" class="text-center">
                    <div class="my-1">
                        ALL WINS PAY LEFTMOST TO RIGHT, EXCEPT <img src="scatter.png" style="max-width: 40px;" alt="">
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN FOR BET MULTIPLIER X1.
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN IN CREDITS
                    </div>
                </div>
    
                <div class="divider-container mt-5">
                    <div class="divider-wrapper">
                        <div class="divider-text" style="font-weight: bold;">243 WAYS</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
    
                <div class="row px-3 my-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4">
                        <img src="tick.png" class="mx-4" style="max-width: 80%;" alt="">
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12">
                        REELS = 5
                        <div class="d-flex justify-content-start align-items-center">
                            PLAY 5 REELS WITH MINIMUM BET 30 MULTIPLIED BY DENOMINATION.
                        </div>
                    </div>
                </div>
                <div>
                    <div style="width: 90%;margin-bottom: 140px;" class="mx-auto mt-3 pb-3">
                        <div>
                            ALL WINNING COMBINATIONS PAY FROM LEFT TO RIGHT ON ADJACENT REELS BEGINNING FROM LEFTMOST EXCEPT <img src="scatter.png" style="width: 40px;" alt="">
                        </div>
                        <div>
                            ALL WINS ARE MULTIPLIED BY THE BET MULTIPLIER. ONLY THE HIGHEST WINNING COMBINATION IS PAID ON EACH PAY WAY.
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="text-center py-3 w-100" style="position: fixed;bottom: 0;background-color: #191818;color: white;font-size: 1.0rem;z-index: 9999;margin: 0 !important;">
                <div>
                    MALFUNCTION VOIDS ALL PLAYS AND PAYS.
                </div>
                <div class="my-2 d-flex justify-content-center align-items-center">
                    <div class="d-flex justify-content-center align-items-center" style="height: 45px;width: 45px;border-radius: 50%;border-color: white;border-style: solid;">
                        <i id="close_info_button" class="fa fa-arrow-left fa-2x py-2 px-2"></i>
                    </div>
                </div>
            </div>
        </div>


        <div id="device_overlay">
            <div class="d-flex flex-column justify-content-center align-items-center text-center p-4" 
                style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.99); color: white; font-size: 1.5rem; text-align: center; z-index: 9999; display: flex;">
                <div class="container">
                    <h2 class="fw-bold">FOR AN OPTIMAL GAMING EXPERIENCE</h2>
                    <p class="lead">USE A MOBILE DEVICE</p>
                    <div class="my-3 text-center my-3">
                        <i class="fa fa-mobile-alt fa-3x"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="winOverlay" class="mobile-wrapper">
            <button id="closeBtn" class="btn-close btn-close-white" aria-label="Close"></button>
            <div id="coinsContainer"></div>
            <div class="sunburst-container">
                <div id="sunburst" class="sunburst mega-win-color"></div>
            </div>
            <div class="win-content">
                <h2 id="winText" class="win-text big-win">BIG WIN</h2>
                <div class="counter-text" id="winAmount">$0</div>
            </div>
        </div>
        
        <div id="jdb_overlay" style="display: none;">
            <div style="height: 100%; width: 100%;" class="d-flex justify-content-center align-items-center">
                <div class="row">
                    <div class="d-flex justify-content-center align-items-center mx-auto">
                        <div>
                            <img src="jdb_logo.png" style="max-width: 100%;" alt="mx-auto">
                            <div class="d-flex justify-content-center mx-auto">
                                <div class="loader-container" style="width: 50%; border-style: solid; border-width: 1px; border-radius: 12px;">
                                    <div class="loader-bar" style="border-radius: 12px;" id="loader-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <div id="kong_overlay" style="display: none;">
            <div class="d-flex justify-content-center">
                <button class="glowing-button text-white" onclick="hideKongOverlay()">START</button>
            </div>
        </div>
    
        <div id="game-container" class="victor-mono">
            <div>
                <img id="img_top" src="bg-top6.gif" style="width: 100%;height: auto;" alt="">
                <img id="img_top_volcano_part_1" src="volcano.gif" style="width: 100%;height: auto;display: none;" alt="">
                <img id="img_top_volcano_part_2" src="volcano-part-2-complete.gif" style="width: 100%;height: auto;display: none;" alt="">
            </div>
            <div id="playground" style="position: relative; overflow: hidden;min-height: 35vh; width: 100%; background-size: cover; z-index: 99;">
                <!-- Start Free Spins Overlay -->
                <div id="startfreespinsoverlay">
                    <div class="d-flex justify-content-center align-items-center" style="height: 100%; width: 100%;">
                        <div id="startfreespinsbutton" class="py-1 px-3 text-white" style="border-radius: 6px; border: 2px white solid; font-size: 0.75rem; background-color: rgba(0, 0, 0, 0.8);">
                            PRESS REEL TO START THE BONUS
                        </div>
                    </div>
                </div>

                <!-- Free Spins Overlay -->
                <div id="freespinsoverlay" style="display: none; position: absolute; top: 0; left: 0; background-color: rgba(0, 0, 0, 0.8); height: 100%; width: 100%; z-index: 999999;">
                    <div class="py-3 px-3 d-flex justify-content-center align-items-center" style="height: 100%;width:100%;">
                        <img class="py-2 px-2" id="freespinsoverlayimg" src="freespinsoverlay.png" style="width: 85%; height: auto;" alt="">
                        <img class="py-2 px-2" id="freespinsoverlayimg2" src="additionalfreespins.png" style="display: none; width: 85%; height: auto;" alt="">
                    </div>
                </div>

                <!-- Game Canvas Content -->
                <div class="game-canvas-container">
                    <!-- Free Spins Indicator -->
                    <div id="free-spins-indicator" class="free-spins-indicator">
                        FREE SPINS: <span id="free-spins-count">0</span> | MULTIPLIER: <span id="bonus-multiplier">0</span>x
                    </div>

                    <!-- Win Message -->
                    <div id="win-message" class="win-message">
                        <div>BIG WIN!</div>
                        <div id="win-amount">0.00</div>
                    </div>
                    
                    <!-- Canvas for the slot machine -->
                    <canvas id="slotMachine"></canvas>
                </div>
            </div>

            <!-- Controls -->
            <div class="game-controls p-2">
                <div id="results_holder" class="w-100 text-center text-white d-flex justify-content-center align-items-center" style="margin-top: -25px;height: 25px; font-size: 1.3rem;">
                    <div style="margin: 5px 0px;">
                        WIN <span class="px-1" id="update_winnings">0.00</span>
                    </div>
                </div>
                <div id="freespins_display" style="display: none; justify-content: center; align-items: center; padding-top: 2px;max-width: 100%;height: 100px;">
                    <img class="fs-text-image"  src="freespin_part_a.png" alt="">
                    <span class="px-3" id="remaining_fs_holder" >0</span>
                    <img class="fs-text-image" src="freespin_part_b.png"  alt="">
                    <span class="px-3" id="total_fs_holder">0</span>
                </div>
                <div id="normalspins_display" style="display: flex; justify-content: center; align-items: center; padding-top: 2px">
                    <div id="autoPlayButton" class="rounded-circle d-flex justify-content-center align-items-center autoplay-button" style="background-image: url('autospinbcg.png');background-size: cover;">
                        <img src="autospininnerimg.png" class="autospininner-img"  alt="">
                    </div>
                    <div id="spinButton" class="mx-4 d-flex justify-content-center align-items-center spin-button" style="border-radius: 50%;background-image: url('spinbcg.png');background-size: cover;">
                        <div id="remainingAutoSpins" style="z-index: 2;position: absolute;color: darkorange;font-weight:bolder;font-size: 1.5rem;">
                        </div>
                        <div class="d-flex justify-content-center align-items-center spin-img" id="spin_img" style="background: url('spininnerimg.png');background-size: cover;">
                            
                        </div>
                    </div>
                    
                    <!-- Stake button that opens the overlay -->
                    <div id="stakeButton" class="text-center d-flex justify-content-center align-items-center stake-button" style="background-image: url('totalbetbcg.png');background-size: cover;color: orange;font-size: 0.85rem;line-height: 1;font-weight: 900;border-radius: 50%;">
                        <div>
                            <div class="d-flex justify-content-center">
                                <img src="totalbetinnerimg.png" class="totalbetinner-img"  alt="">
                            </div>
                            <div class="text-center">
                                <span id="currentStake" class="current-stake">0.3</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mb-2">
                    <div style="display: flex; width: 100%; position: relative; align-items: center;">
                        <div onclick="displaySettingsOverlay2()" id="settingsButton" style="border-radius: 50%;width: 50px; height: 50px;background-image: url('settings.png');background-size: cover;">
                        </div>

                        <script>
                            function displaySettingsOverlay2() {
                                settingsOverlay.style.display = 'block';
                            };
                        </script>

                        <!-- Button at the center -->
                        <div style="position: absolute; left: 50%; transform: translateX(-50%); text-align: center;">
                            <span class="text-center">
                                <span class="badge px-4 py-2 text-white" style="background-color: rgba(0,0,0,0.7);">CREDIT: <span id="balanceText">...</span></span>
                                <br>
                                <span class="text-white text-center" style="font-size: 1.0rem;">
                                    &lt; <span>DEMO GAME</span> &gt;
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Stake Selection Overlay -->
        <div id="stakeOverlay" class="overlay" style="margin: 0 !important; padding: 0 !important;">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider"></div>
                    <div class="divider-text">TOTAL BET</div>
                    <div class="divider"></div>
                </div>
            </div>
            <div class="overlay-content-stake">
                <div class="overlay-header">FUN</div>
                <div class="options-grid mx-auto" id="stakeOptions">
                    <button class="option-button" data-value="3.0">3.0</button>
                    <button class="option-button" data-value="1.5">1.5</button>
                    <button class="option-button" data-value="0.9">0.9</button>
                    <button class="option-button" data-value="0.6">0.6</button>
                    <button class="option-button selected" data-value="0.3">0.3</button>
                </div>
                <div class="text-center text-white mt-5 pt-5">
                    <span style="margin-left: 20px;">
                        Reels: 5
                    </span>
                </div>
                <div class="overlay-footer w-100">
                    <button style="display: none;" class="cancel-button px-4" id="cancelStake">Cancel</button>
                    <button class="confirm-button px-5" id="confirmStake">OK</button>
                </div>
            </div>
        </div>
    
        <!-- Auto Spin Overlay -->
        <div id="autoSpinOverlay" class="overlay">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider"></div>
                    <div class="divider-text">AUTOPLAYS</div>
                    <div class="divider"></div>
                </div>
            </div>
            <div class="overlay-content w-100" style="margin-top: 20px !important;">
                <div class="mb-2 text-white">
                    NUMBER OF SPINS
                </div>
                <div class="options-grid" id="autoSpinOptions">
                    <button class="option-button" data-value="0"><i class="fa fa-stop"></i></button>
                    <button class="option-button" data-value="999">999</button>
                    <button class="option-button" data-value="200">200</button>
                    <button class="option-button" data-value="100">100</button>
                    <button class="option-button" data-value="30">30</button>
                </div>
                
<div class="mt-4 mb-2 text-white">
    LOSS LIMIT
</div>
<div class="options-grid" id="lossLimitOptions">
    <button class="option-button" data-value="Infinity"><i class="fa fa-infinity"></i></button>
    <button class="option-button" data-value="500">500<span style="font-size: 0.7rem;">x BET</span></button>
    <button class="option-button" data-value="100">100<span style="font-size: 0.7rem;">x BET</span></button>
    <button class="option-button" data-value="50">50<span style="font-size: 0.7rem;">x BET</span></button>
    <button class="option-button" data-value="10">10<span style="font-size: 0.7rem;">x BET</span></button>
</div>
                <div class="divider-container my-3">
                    <div class="divider-wrapper">
                        <div style="height: 2px;background-color: #e4d594;width: 25vw;"></div>
                        <div class="divider-text" >QUICK SPIN</div>
                        <div style="height: 2px;background-color: #e4d594;width: 25vw;"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <img id="quickspin-toggle" src="quickspin-a.png" style="height: 60px;width: 60px;" alt="">
                </div>
                <div class="overlay-footer">
                    <button class="cancel-button" id="cancelAutoSpin">Cancel</button>
                    <button class="confirm-button px-5" id="confirmAutoSpin">Ok</button>
                </div>
            </div>
        </div>
    
        <!-- Settings Overlay -->
        <div id="settingsOverlay" class="overlay" style="background-color: rgb(0,0,0,0.8); margin: 0 !important; padding: 0 !important;">
            <div onclick="hideSettingsOverlay()" class="overlay-content w-100" style="height: 100%; margin: 0 !important; padding: 0 !important;">
                <div>
                    <div style="display: none;">
                        <div class="d-flex justify-content-center">
                            <div id="soundEffectsOption" class="sound-option selected mx-auto">
                                <div>
                                    <span id="soundEffectsIcon" class="icon-container">🔊</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="overlay-footer" style="background-image: url('bcg-settings.png');background-size: cover;margin: 0 !important;padding: 0 !important;">
                <div class="w-100 mb-2">
                    <div class="d-flex justify-content-around align-items-center py-5 px-3 w-100">
                        <div id="info_button" class="sound-option selected">
                            <div class="d-flex justify-content-center align-items-center" style="color: #e4d594; width: 30px; height: 30px; border-radius: 50%; border-color: #e4d594; border-style: solid;">
                                <i class="fas fa-question" style="font-size: 1.2rem; font-weight: bold;"></i>
                            </div>
                        </div>
                        <div id="backgroundMusicOption" class="sound-option selected">
                            <div>
                                <span id="backgroundMusicIcon" class="icon-container">
                                    <i class="fa fa-volume-up" style="color: #e4d594; font-size: 1.4rem;"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <i class="fa fa-user px-1"></i> <span style="font-size: 0.7rem;">demo004817</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Game configuration
    const REEL_COUNT = 5;
    const SYMBOLS_PER_REEL = 3;
    const SYMBOL_SIZE = 100;
    const REEL_WIDTH = SYMBOL_SIZE;
    const REEL_HEIGHT = SYMBOL_SIZE * SYMBOLS_PER_REEL;
    // Individual wall thickness for each wall (top, right, bottom, left)
    const WALL_THICKNESS = {
        top: 20,
        right: 7,
        bottom: 25,
        left: 7
    };
    const GAME_WIDTH = REEL_WIDTH * REEL_COUNT + WALL_THICKNESS.left + WALL_THICKNESS.right;
    const GAME_HEIGHT = REEL_HEIGHT + WALL_THICKNESS.top + WALL_THICKNESS.bottom;
    
    // Extra symbols to draw above and below visible area for smooth scrolling
    const EXTRA_SYMBOLS = 2;

    const SYMBOLS = [
        { name: 'Treasure Chest', image: 'treasurechest.png', color: '#ff5252', payouts: [0, 0, 40, 100, 250], normal_scale: 1.2, z_index: 10 },
        { name: 'Explorer', image: 'explorer.png', color: '#ffeb3b', payouts: [0, 0, 30, 80, 200], normal_scale: 1.2, z_index: 5 },
        { name: 'Compass', image: 'compass.png', color: '#ff9800', payouts: [0, 0, 25, 60, 175], normal_scale: 1.15, z_index: 4 },
        { name: 'Binoculars', image: 'binoculars.png', color: '#9c27b0', payouts: [0, 0, 20, 50, 150], normal_scale: 1.15, z_index: 4 },
        { name: 'A', image: 'A.png', color: '#f44336', payouts: [0, 0, 10, 20, 100], normal_scale: 1.10, z_index: 3 },
        { name: 'K', image: 'K.png', color: '#4caf50', payouts: [0, 0, 8, 15, 90], normal_scale: 1.10, z_index: 3 },
        { name: 'Q', image: 'Q.png', color: '#ffc107', payouts: [0, 0, 6, 12, 80], normal_scale: 1.10, z_index: 3 },
        { name: 'J', image: 'J.png', color: '#2196f3', payouts: [0, 0, 5, 10, 70], normal_scale: 1.10, z_index: 3 },
        { name: 'Wild', image: 'wild.png', color: '#00bcd4', payouts: [0, 0, 50, 125, 300], normal_scale: 1.25, z_index: 10 },
        { name: 'Scatter', image: 'scatter.png', color: '#e91e63', payouts: [0, 0, 5, 20, 50], normal_scale: 1.30, z_index: 11 }
    ];

    
    const SYMBOL_SCALE_MAP = {
        'Treasure Chest': 1.6,
        'Explorer': 1.5,
        'Compass': 1.45,
        'Binoculars': 1.4,
        'A': 1.3,
        'K': 1.25,
        'Q': 1.2,
        'J': 1.15,
        'Wild': 1.55,
        'Scatter': 1.35
    };


    // Wall colors (different backgrounds)
    const WALL_BACKGROUNDS = [
        '#3a0ca3', // top
        '#4361ee', // right
        '#4cc9f0', // bottom
        '#7209b7'  // left
    ];

    // Free spin wall backgrounds
    const FREESPIN_WALL_BACKGROUNDS = [
        '#ff6b6b', // top
        '#f9844a', // right
        '#ffd166', // bottom
        '#ff9e00'  // left
    ];

    // Global variables for animations
    let activeAnimations = {};
    let wildFrameImages = [];
    let loadedWildFrames = 0;
    const wildFrameCount = 33;


    // Load individual reel background images
    const reelBackgroundImages = [];
    const reelBackgroundLoaded = [];

    for (let i = 0; i < REEL_COUNT; i++) {
        reelBackgroundImages[i] = new Image();
        reelBackgroundImages[i].src = `reel-bg.jpg`; // Replace with your image paths
        reelBackgroundImages[i].crossOrigin = "anonymous"; // Avoid CORS issues
        reelBackgroundLoaded[i] = false;
        
        reelBackgroundImages[i].onload = () => {
            reelBackgroundLoaded[i] = true;
        };
    }

    // Get canvas and context
    const canvas = document.getElementById('slotMachine');
    const ctx = canvas.getContext('2d');
    
    // Get DOM elements
    const spinButton = document.getElementById('spinButton');
    const autoPlayButton = document.getElementById('autoPlayButton');
    const stakeButton = document.getElementById('stakeButton');
    const settingsButton = document.getElementById('settingsButton');
    const featuresButton = document.getElementById('featuresButton');
    const featuresOverlay = document.getElementById('featuresOverlay');
    const remainingAutoSpins = document.getElementById('remainingAutoSpins');
    const spinButtonInnerImage = document.getElementById('spin_img');
    const balanceText = document.getElementById('balanceText');
    const currentStakeElement = document.getElementById('currentStake');
    const stakeOverlay = document.getElementById('stakeOverlay');
    const infoOverlay = document.getElementById('gameinfo_overlay');
    const closeInfoButton = document.getElementById('close_info_button');
    const infoButton = document.getElementById('info_button');
    const autoSpinOverlay = document.getElementById('autoSpinOverlay');
    const stakeOptions = document.getElementById('stakeOptions');
    const autoSpinOptions = document.getElementById('autoSpinOptions');
    const cancelStakeButton = document.getElementById('cancelStake');
    const confirmStakeButton = document.getElementById('confirmStake');
    const cancelAutoSpinButton = document.getElementById('cancelAutoSpin');
    const confirmAutoSpinButton = document.getElementById('confirmAutoSpin');
    const winMessageElement = document.getElementById('win-message');
    const winAmountElement = document.getElementById('win-amount');
    const freeSpinsIndicator = document.getElementById('free-spins-indicator');
    const freeSpinsCountElement = document.getElementById('free-spins-count');
    const bonusMultiplierElement = document.getElementById('bonus-multiplier');
    const settingsOverlay = document.getElementById('settingsOverlay');
    const soundEffectsOption = document.getElementById('soundEffectsOption');
    const backgroundMusicOption = document.getElementById('backgroundMusicOption');
    const soundEffectsIcon = document.getElementById('soundEffectsIcon');
    const backgroundMusicIcon = document.getElementById('backgroundMusicIcon');
    const startFreeSpinsOverlay = document.getElementById('startfreespinsoverlay');
    const startFreeSpinsButton = document.getElementById('startfreespinsbutton');
    const freeSpinsOverlay = document.getElementById('freespinsoverlay');
    const freeSpinsOverlayImg = document.getElementById('freespinsoverlayimg');
    const freeSpinsOverlayImg2 = document.getElementById('freespinsoverlayimg2');
    const quickspinToggleImg = document.getElementById('quickspin-toggle');
    const loaderBar = document.getElementById('loader-bar');
    const jdbOverlay = document.getElementById('jdb_overlay');
    const kongOverlay = document.getElementById('kong_overlay');
    const deviceOverlay = document.getElementById('device_overlay');
    const lossLimitOptions = document.getElementById('lossLimitOptions');

    // Game state
    let spinning = false;
    let reels = [];
    let finalResults = [];
    let winAmount = 0;
    let winAmountDisplay = 0;
    let winAnimationStartTime = 0;
    let isAnimatingWin = false;
    let symbolImages = {}; // Object to store loaded images
    let imagesLoaded = 0;
    let totalImages = SYMBOLS.length;
    let balance = 0; // Starting balance
    let stake = 0.3; // Default bet amount
    let autoSpins = 0;
    let currentInterval;
    let selectedStake = 0.3; // Default stake value
    let selectedAutoSpins = 0; // Default auto spins value
    let initialBalance = 0;
    let lossLimit = Infinity; // Default to no limit
    let selectedLossLimit = Infinity; // Default selected loss limit
    let autoSpinsStopped = true;
    let isQuickSpinMode = false;
    
    // Free spins state
    let freeSpinTriggeredRecently = false;
    let isFreeSpinMode = false;
    let freeSpinCount = 0;
    let remainingFreeSpinCount = 0;
    let bonusMultiplier = 0;
    let originalBetAmount = 0;

    // Free spin wall images
    const freeSpinWallImages = [
        new Image(), // Top wall
        new Image(), // Right wall
        new Image(), // Bottom wall
        new Image()  // Left wall
    ];

    // Set free spin wall image sources
    freeSpinWallImages[0].src = 'freespin-wall-top.png';
    freeSpinWallImages[1].src = 'freespin-wall.png';
    freeSpinWallImages[2].src = 'freespin-resultsbcg.png';
    freeSpinWallImages[3].src = 'freespin-wall.png';

    // Preload all free spin wall images
    let freeSpinWallImagesLoaded = 0;
    freeSpinWallImages.forEach((img) => {
        img.onload = () => {
            freeSpinWallImagesLoaded++;
        };
    });
    
    // Sound control variables
    let soundEffectsEnabled = true;
    let backgroundMusicEnabled = true;
    let tempSoundEffectsEnabled = true;
    let tempBackgroundMusicEnabled = true;
    
    // Game mode
    const gameMode = {
        'mode': 'demo'
    };
    const currentDemoFeature = {
        "feature": "normal spin"
    };

    
    
    // Audio elements
    const backgroundMusic = new Audio();
    backgroundMusic.src = 'gameaudio.mp3';
    backgroundMusic.loop = true;
    backgroundMusic.volume = 0.5;
    backgroundMusic.preload = 'auto';

    const bigWinSound = new Audio();
    bigWinSound.src = 'sounds/SE_BigWin.mp3';
    bigWinSound.loop = true;
    bigWinSound.volume = 0.8;

    const reelSpeedUpSound = new Audio();
    reelSpeedUpSound.src = 'sounds/SE_ReelSpeedUp.mp3';
    reelSpeedUpSound.loop = true;
    reelSpeedUpSound.volume = 0.9;

    const freeSpinSound = new Audio();
    freeSpinSound.src = 'sounds/SE_Free_BG.mp3';
    freeSpinSound.loop = true;
    freeSpinSound.volume = 0.9;

    const spinSound = new Audio();
    spinSound.src = 'sounds/spin.mp3';
    spinSound.preload = 'auto';
    
    const winSound = new Audio();
    winSound.src = 'win.mp3';
    winSound.preload = 'auto';

    // Coin images for win animation
    coinImages = [
        "coins/0_BigWin_SS.png", "coins/1_BigWin_SS.png", "coins/2_BigWin_SS.png", "coins/3_BigWin_SS.png",
        "coins/4_BigWin_SS.png", "coins/5_BigWin_SS.png", "coins/6_BigWin_SS.png", "coins/7_BigWin_SS.png",
        "coins/8_BigWin_SS.png", "coins/9_BigWin_SS.png", "coins/10_BigWin_SS.png", "coins/11_BigWin_SS.png",
        "coins/12_BigWin_SS.png", "coins/13_BigWin_SS.png", "coins/14_BigWin_SS.png", "coins/15_BigWin_SS.png",
        "coins/16_BigWin_SS.png", "coins/17_BigWin_SS.png", "coins/18_BigWin_SS.png", "coins/19_BigWin_SS.png",
        "coins/20_BigWin_SS.png", "coins/21_BigWin_SS.png", "coins/22_BigWin_SS.png", "coins/23_BigWin_SS.png",
        "coins/24_BigWin_SS.png", "coins/25_BigWin_SS.png", "coins/26_BigWin_SS.png", "coins/27_BigWin_SS.png",
        "coins/28_BigWin_SS.png", "coins/29_BigWin_SS.png", "coins/30_BigWin_SS.png"
    ];

    // Win level configurations
    const winLevels = {
        big: {
            text: 'BIG WIN',
            textClass: 'big-win',
            sunburstClass: 'big-win-color',
            threshold: 50,
            coinCount: 50
        },
        mega: {
            text: 'MEGA WIN',
            textClass: 'mega-win',
            sunburstClass: 'mega-win-color',
            threshold: 150,
            coinCount: 100
        },
        ultra: {
            text: 'ULTRA WIN',
            textClass: 'ultra-win',
            sunburstClass: 'ultra-win-color',
            threshold: Infinity,
            coinCount: 200
        }
    };

    // Resize canvas to fit container
    function resizeCanvas() {
        const container = document.querySelector('.game-canvas-container');
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        
        // Redraw the game
        if (reels.length > 0) {
            drawGame();
        }
    }

    // Initialize loading screen
    function initLoading() {
        let progress = 0;

        function updateProgress() {
            progress += Math.random() * 10;

            if (progress > 100) progress = 100;

            loaderBar.style.width = progress + "%";

            // Interpolate green from 165 (orange) to 140 (darkorange)
            let green = 165 - (progress / 100) * (165 - 140);
            loaderBar.style.backgroundColor = `rgb(255, ${green}, 0)`;

            if (progress < 100) {
                setTimeout(updateProgress, 500);
            } else {
                setTimeout(() => {
                    jdbOverlay.style.display = "none";
                }, 500);
            }
        }

        updateProgress();
    }

    // Hide Kong overlay
    function hideKongOverlay() {
        kongOverlay.style.display = "none";
        // Try to play background music (will be blocked by browsers until user interaction)
        backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
    }

    // Preload all symbol images
    function preloadImages() {
        SYMBOLS.forEach(symbol => {
            const img = new Image();
            img.crossOrigin = "anonymous"; // Avoid CORS issues
            img.onload = () => {
                imagesLoaded++;
                if (imagesLoaded === totalImages) {
                    // All images loaded, start the game
                    initGame();
                }
            };
            img.onerror = (err) => {
                console.error(`Error loading image for ${symbol.name}:`, err);
                // Create a fallback image with just the symbol color
            };
            
            img.src = symbol.image;
            symbolImages[symbol.name] = img;
        });
    }

    function preloadWildFrames() {
        for (let i = 0; i <= wildFrameCount; i++) {
            const img = new Image();
            img.crossOrigin = "anonymous";
            img.onload = () => {
                loadedWildFrames++;
            };
            img.src = `wildframes3/frame_${i}.png`;
            wildFrameImages.push(img);
        }
    }
    
    // Initialize the game
    function initGame() {
        // Resize canvas to fit container
        resizeCanvas();
        
        // Create initial reels
        for (let i = 0; i < REEL_COUNT; i++) {
            // Initialize each reel
            reels[i] = {
                position: 0,
                symbols: [],
                finalSymbols: [],
                isSpinning: false, // Track if this reel is currently spinning
                specialSymbols: {} // Track which symbols are special (larger with higher z-index)
            };
            
            // Generate initial symbols (visible + extra for scrolling)
            const totalSymbols = SYMBOLS_PER_REEL + EXTRA_SYMBOLS * 2;
            for (let j = 0; j < totalSymbols; j++) {
                const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
                random_symbol_name = SYMBOLS[randomIndex].name
                reels[i].symbols.push({
                    name: random_symbol_name,
                    isSpecial: true,
                    scale: SYMBOL_SCALE_MAP[random_symbol_name] // Random scale between 1.1 and 1.6
                });
            }
            
            // Set initial final symbols (what will be shown when not spinning)
            reels[i].finalSymbols = reels[i].symbols.slice(EXTRA_SYMBOLS, EXTRA_SYMBOLS + SYMBOLS_PER_REEL);
        }
        
        // Draw initial state
        drawGame();
        
        // Update balance display
        displayBalance(balance);


        setTimeout(() => {
            if (gameMode.mode === "live") {
                initialBalance = parseFloat(playerInfo.wallet_balance).toFixed(2);
                balance = parseFloat(playerInfo.wallet_balance).toFixed(2);
                displayBalance(balance)
            } else if (gameMode.mode === "demo") {
                balance = 1000;
                initialBalance = 1000;
                displayBalance(balance)
            } else {
                balance = undefined;
            }

            // You can use initialBalance here or call another function with it
            console.log("Balance:", balance);
        }, 5000);
        
        // Add event listeners
        spinButton.addEventListener('click', spin);
        autoPlayButton.addEventListener('click', toggleAutoPlay);
        stakeButton.addEventListener('click', showStakeOverlay);
        settingsButton.addEventListener('click', displaySettingsOverlay);
        featuresButton.addEventListener('click', showFeaturesOverlay);
        infoButton.addEventListener('click', showInfoOverlay);
        closeInfoButton.addEventListener('click', hideInfoOverlay);
        startFreeSpinsButton.addEventListener('click', startFreeSpins);
        quickspinToggleImg.addEventListener('click', toggleQuickSpin);
        
        // Add event listeners for overlays
        cancelStakeButton.addEventListener('click', hideStakeOverlay);
        confirmStakeButton.addEventListener('click', confirmStake);
        cancelAutoSpinButton.addEventListener('click', hideAutoSpinOverlay);
        confirmAutoSpinButton.addEventListener('click', confirmAutoSpin);
        


        // Cancel settings
        function hideSettingsOverlay() {
            settingsOverlay.style.display = 'none';
            // Revert to previous settings (don't apply changes)
        };

        // Confirm settings
        function confirmSettings() {
            // Apply the temporary settings
            soundEffectsEnabled = tempSoundEffectsEnabled;
            backgroundMusicEnabled = tempBackgroundMusicEnabled;
            
            // Update background music based on new setting
            if (backgroundMusicEnabled) {
                backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
            } else {
                backgroundMusic.pause();
            }
            
            settingsOverlay.style.display = 'none';
        };

        // Handle stake option selection
        stakeOptions.addEventListener('click', (e) => {
            if (e.target.classList.contains('option-button')) {
                // Remove selected class from all options
                const options = stakeOptions.querySelectorAll('.option-button');
                options.forEach(option => option.classList.remove('selected'));
                
                // Add selected class to clicked option
                e.target.classList.add('selected');
                
                // Update selected stake value
                selectedStake = parseFloat(e.target.dataset.value);
            }
        });

        // Handle auto spin option selection
        autoSpinOptions.addEventListener('click', (e) => {
            if (e.target.classList.contains('option-button')) {
                // Remove selected class from all options
                const options = autoSpinOptions.querySelectorAll('.option-button');
                options.forEach(option => option.classList.remove('selected'));
                
                // Add selected class to clicked option
                e.target.classList.add('selected');
                
                // Update selected auto spins value
                selectedAutoSpins = parseInt(e.target.dataset.value);
        
                // Check if any loss limit option is currently selected
                const hasSelectedLossLimit = Array.from(
                    lossLimitOptions.querySelectorAll('.option-button')
                ).some(option => option.classList.contains('selected'));
                
                // If no loss limit is selected, automatically select the "Infinity" option
                if (!hasSelectedLossLimit) {
                    const infinityOption = lossLimitOptions.querySelector('.option-button[data-value="Infinity"]');
                    if (infinityOption) {
                        infinityOption.classList.add('selected');
                        selectedLossLimit = Infinity;
                    }
                }
            }
        });

// Handle loss limit option selection
const lossLimitOptions = document.getElementById('lossLimitOptions');
lossLimitOptions.addEventListener('click', (e) => {
    if (e.target.classList.contains('option-button')) {
        // Remove selected class from all options
        const options = lossLimitOptions.querySelectorAll('.option-button');
        options.forEach(option => option.classList.remove('selected'));
        
        // Add selected class to clicked option
        e.target.classList.add('selected');
        
        // Update selected loss limit value
        const value = e.target.dataset.value;
        selectedLossLimit = value === "Infinity" ? Infinity : parseInt(value);
    }
});



        // Add event listeners for settings
        backgroundMusicOption.addEventListener('click', toggleBackgroundMusic);
        
        // Add event listener for win overlay close button
        document.getElementById('closeBtn').addEventListener('click', closeWinAnimation);
        
        // Add window resize event listener
        window.addEventListener('resize', resizeCanvas);
        
        // Check if device is desktop
        if (window.innerWidth >= 900) {
            deviceOverlay.style.display = "none";
        }
    }

    // Function to close the win animation
    function closeWinAnimation() {
        const winOverlay = document.getElementById('winOverlay');
        winOverlay.style.display = 'none';
        
        // Stop big win sound and resume background music
        if (soundEffectsEnabled) {
            bigWinSound.pause();
            bigWinSound.currentTime = 0;
            
            if (backgroundMusicEnabled) {
                if (isFreeSpinMode) {
                    freeSpinSound.play().catch(e => console.log("Audio play failed:", e));
                } else {
                    backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
                }
            }
        }
        
        // Clear all coins
        const coinsContainer = document.getElementById('coinsContainer');
        coinsContainer.innerHTML = '';
    }


    // Display balance
    function displayBalance(amount) {
        balanceText.innerHTML = parseFloat(amount).toFixed(2);
    }

    // Show features overlay
    function showFeaturesOverlay() {
        featuresOverlay.style.display = "block";
    }

    // Set demo feature
    function setDemoFeature(feature) {
        isFirstSpin = true; // Set first spin to trigger the passed feature
        currentDemoFeature.feature = feature;
        featuresOverlay.style.display = "none";
        spin();
    }

    // Show info overlay
    function showInfoOverlay() {
        hideSettingsOverlay();
        if (!spinning && !isFreeSpinMode) {
            infoOverlay.style.display = 'block';
        }
    }

    // Hide info overlay
    function hideInfoOverlay() {
        infoOverlay.style.display = 'none';
    }

    // Show stake overlay
    function showStakeOverlay() {
        if (!spinning && !isFreeSpinMode) {
            stakeOverlay.style.display = 'block';
            
            // Highlight the currently selected stake
            const stakeOptionButtons = stakeOptions.querySelectorAll('.option-button');
            stakeOptionButtons.forEach(button => {
                const value = parseFloat(button.dataset.value);
                if (value === stake) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }
    }

    // Hide stake overlay
    function hideStakeOverlay() {
        stakeOverlay.style.display = 'none';
    }

    // Confirm stake selection
    function confirmStake() {
        stake = selectedStake;
        currentStakeElement.textContent = stake.toFixed(1);
        stakeOverlay.style.display = 'none';
    }

    // Toggle auto play
    function toggleAutoPlay() {
        if (spinning && !isFreeSpinMode) {
            if (autoSpins > 0) {
                autoSpinsStopped = true;
                updateAutoSpinStatus();
                remainingAutoSpins.innerHTML = '';
                autoSpins = 0;
            }
        }
        else if (!spinning && !isFreeSpinMode) {
            if (autoSpins > 0) {
                // Cancel auto spins
                autoSpinsStopped = true;
                updateAutoSpinStatus();
                autoSpins = 0;
            } else {
                autoSpinOverlay.style.display = 'block';
                
                // Highlight the currently selected auto spins
                const autoSpinOptionButtons = autoSpinOptions.querySelectorAll('.option-button');
                autoSpinOptionButtons.forEach(button => {
                    const value = parseInt(button.dataset.value);
                    if (value === selectedAutoSpins) {
                        button.classList.add('selected');
                    } else {
                        button.classList.remove('selected');
                    }
                });
            }
        }
    }

    // Hide auto spin overlay
    function hideAutoSpinOverlay() {
        autoSpinOverlay.style.display = 'none';
    }

    // Confirm auto spin selection
    function confirmAutoSpin() {
        if (selectedAutoSpins > 0) {
            autoSpins = selectedAutoSpins;
            lossLimit = selectedLossLimit;
            initialBalance = balance; // Store initial balance to track losses
            autoSpinOverlay.style.display = 'none';
            autoSpinsStopped = false;
            updateAutoSpinStatus();
            spin();
        }
        else {
            updateAutoSpinStatus();
            autoSpinOverlay.style.display = 'none';
        }
    }

    // Update auto spin status
    function updateAutoSpinStatus() {
        if (autoSpinsStopped) {
            selectedAutoSpins = 0;
            const autoSpinOptionButtons = autoSpinOptions.querySelectorAll('.option-button');
            autoSpinOptionButtons.forEach(button => {
                if (button.classList.contains('selected')) {
                    button.classList.remove('selected');
                }
            });
            autoPlayButton.innerHTML = `<img src="autospininnerimg.png" class="autospininner-img" alt="">`;
        }
        else {
            autoPlayButton.innerHTML = `<img src="autospininnerimgstop.png" class="autospininnerimgstop"  alt="">`
        }
    }


    // Auto play button and overlay functionality
        autoPlayButton.addEventListener('click', () => {
            if (spinning && !isFreeSpinMode) {
                if (autoSpins > 0) {
                    autoSpinsStopped = true;
                    updateAutoSpinStatus();
                    remainingAutoSpins.innerHTML = '';
                    autoSpins = 0;
                }
            }
            else if (!spinning && !isFreeSpinMode) {
                if (autoSpins > 0) {
                    // Cancel auto spins
                    autoSpinsStopped = true;
                    updateAutoSpinStatus();
                    autoSpins = 0;
                } else {
                    autoSpinOverlay.style.display = 'block';
                    
                    // Highlight the currently selected auto spins
                    const autoSpinOptionButtons = autoSpinOptions.querySelectorAll('.option-button');
                    autoSpinOptionButtons.forEach(button => {
                        const value = parseInt(button.dataset.value);
                        if (value === selectedAutoSpins) {
                            button.classList.add('selected');
                        } else {
                            button.classList.remove('selected');
                        }
                    });
                }
            }
        });

        

    // Toggle quick spin
    function toggleQuickSpin() {
        isQuickSpinMode = !isQuickSpinMode;
        quickspinToggleImg.src = isQuickSpinMode ? 
            "quickspin-b.png" : 
            "quickspin-a.png";
    }

    // Display settings overlay

    function displaySettingsOverlay() {
        settingsOverlay.style.display = 'block';
    }

    // Hide settings overlay
    function hideSettingsOverlay() {
        settingsOverlay.style.display = 'none';
    }

    // Toggle background music
    function toggleBackgroundMusic() {
        backgroundMusicEnabled = !backgroundMusicEnabled;
        
        if (backgroundMusicEnabled) {
            backgroundMusicIcon.innerHTML = `<i class="fa fa-volume-up" style="color: #e4d594; font-size: 1.4rem;"></i>`;
            backgroundMusic.play();
        } else {
            backgroundMusicIcon.innerHTML = `<i class="fas fa-volume-mute" style="color: #e4d594; font-size: 1.4rem;"></i>`;
            backgroundMusic.pause();
        }
        
        settingsOverlay.style.display = 'none';
    }

    // Start free spins
    function startFreeSpins() {
        startFreeSpinsOverlay.style.display = "none";
        spin();
    }

    // Rotate spin button image
    function rotateSpinButtonImage() {
        spinButtonInnerImage.style.transition = 'transform 0.5s ease';
        spinButtonInnerImage.style.transform = 'rotate(180deg)';
    }

    // Reset spin button image
    function resetSpinButtonImage() {
        spinButtonInnerImage.style.transition = 'transform 0.5s ease';
        spinButtonInnerImage.style.transform = 'rotate(360deg)';
    }

    // Draw the game
    function drawGame() {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw the game in layers:
        // 1. Background
        drawBackground();
        
        // 2. All walls (drawn first, symbols will appear on top)
        drawWalls();
        
        // 3. Reel backgrounds
        drawReelBackgrounds();
        
        // 4. Draw spinning reels (these will appear to go under the bottom wall)
        drawSpinningReels();
        
        // 5. Draw stopped reels (these will appear on top of all walls)
        drawStoppedReels();
        
        // 6. Win display (if there's a win)
        if (winAmount > 0 && !spinning) {
            drawWinDisplay();
        }
    }

    // Draw background
    function drawBackground() {
        ctx.fillStyle = isFreeSpinMode ? '#1a237e' : '#222222';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    // Define and load wall background images
const wallImages = [
    new Image(), // Top wall
    new Image(), // Right wall
    new Image(), // Bottom wall
    new Image()  // Left wall
];

// Set image sources (replace with actual file paths or URLs)
wallImages[0].src = 'wall-top.png';
wallImages[1].src = 'wall.png';
wallImages[2].src = 'resultsbcg3.png';
wallImages[3].src = 'wall.png';

// Preload all images before drawing walls
let wallImagesLoaded = 0;
wallImages.forEach((img) => {
    img.onload = () => {
        wallImagesLoaded++;
        if (wallImagesLoaded === wallImages.length) {
            drawWalls(); // Draw walls once all images are loaded
        }
    };
});

// Full drawWalls function using individual wall thicknesses
function drawWalls() {
    // Define positions and sizes for each wall
    const wallPositions = [
        { x: 0, y: 0, width: canvas.width, height: WALL_THICKNESS.top }, // Top - full width
        { x: canvas.width - WALL_THICKNESS.right, y: WALL_THICKNESS.top, width: WALL_THICKNESS.right, height: canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom }, // Right - between top and bottom
        { x: 0, y: canvas.height - WALL_THICKNESS.bottom, width: canvas.width, height: WALL_THICKNESS.bottom }, // Bottom - full width
        { x: 0, y: WALL_THICKNESS.top, width: WALL_THICKNESS.left, height: canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom }  // Left - between top and bottom
    ];

    // Draw each wall using its corresponding color or image
    for (let i = 0; i < 4; i++) {
        const wall = wallPositions[i];
        
        if (isFreeSpinMode) {
            // Use free spin wall backgrounds
            ctx.fillStyle = FREESPIN_WALL_BACKGROUNDS[i];
            ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            
            // If free spin wall images are loaded, draw them instead
            if (freeSpinWallImagesLoaded === freeSpinWallImages.length) {
                const image = freeSpinWallImages[i];
                // Draw the image stretched to fit the wall area
                ctx.drawImage(image, wall.x, wall.y, wall.width, wall.height);
            }
        } else {
            // Use normal wall backgrounds
            ctx.fillStyle = WALL_BACKGROUNDS[i];
            ctx.fillRect(wall.x, wall.y, wall.width, wall.height);
            
            // If normal wall images are loaded, draw them instead
            if (wallImagesLoaded === wallImages.length) {
                const image = wallImages[i];
                // Draw the image stretched to fit the wall area
                ctx.drawImage(image, wall.x, wall.y, wall.width, wall.height);
            }
        }
    }
}

// Draw reel backgrounds
function drawReelBackgrounds() {
    const reelWidth = (canvas.width - WALL_THICKNESS.left - WALL_THICKNESS.right) / REEL_COUNT;
    const reelHeight = canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom;
    
    // Draw background for reels area
    ctx.fillStyle = isFreeSpinMode ? '#1a237e' : '#000000';
    ctx.fillRect(
        WALL_THICKNESS.left, 
        WALL_THICKNESS.top, 
        reelWidth * REEL_COUNT, 
        reelHeight
    );
    
    // Draw individual reel backgrounds
    for (let i = 0; i < REEL_COUNT; i++) {
        const reelX = WALL_THICKNESS.left + i * reelWidth;
        const reelY = WALL_THICKNESS.top;
        
        // Draw reel background
        ctx.fillStyle = isFreeSpinMode ? '#303f9f' : '#333333';
        ctx.fillRect(reelX, reelY, reelWidth, reelHeight);
        
        // Draw reel border
        ctx.strokeStyle = isFreeSpinMode ? '#5c6bc0' : '#666666';
        ctx.lineWidth = 2;
        ctx.strokeRect(reelX, reelY, reelWidth, reelHeight);
    }
    
    // Draw dividing lines between symbols
    // for (let i = 1; i < SYMBOLS_PER_REEL; i++) {
    //     ctx.beginPath();
    //     ctx.moveTo(WALL_THICKNESS.left, WALL_THICKNESS.top + i * (reelHeight / SYMBOLS_PER_REEL));
    //     ctx.lineTo(WALL_THICKNESS.left + reelWidth * REEL_COUNT, WALL_THICKNESS.top + i * (reelHeight / SYMBOLS_PER_REEL));
    //     ctx.strokeStyle = 'rgba(255, 255, 255, 0.2)';
    //     ctx.lineWidth = 1;
    //     ctx.stroke();
    // }
}

// Draw spinning reels
function drawSpinningReels() {
    const reelWidth = (canvas.width - WALL_THICKNESS.left - WALL_THICKNESS.right) / REEL_COUNT;
    const reelHeight = canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom;
    const symbolHeight = reelHeight / SYMBOLS_PER_REEL;
    
    // Create clipping region for spinning reels
    ctx.save();
    ctx.beginPath();
    ctx.rect(
        WALL_THICKNESS.left, 
        WALL_THICKNESS.top, 
        reelWidth * REEL_COUNT, 
        reelHeight
    );
    ctx.clip();
    
    // Draw spinning reels
    for (let i = 0; i < REEL_COUNT; i++) {
        // Only draw if this reel is still spinning
        if (!reels[i].isSpinning) continue;
        
        const reelX = WALL_THICKNESS.left + i * reelWidth;
        const reelY = WALL_THICKNESS.top;
        
        // Draw symbols
        for (let j = 0; j < reels[i].symbols.length; j++) {
            const symbol = reels[i].symbols[j];
            const symbolData = SYMBOLS.find(s => s.name === symbol.name);
            
            // Calculate position with scrolling offset
            const symbolX = reelX;
            const symbolY = reelY - symbolHeight * EXTRA_SYMBOLS + j * symbolHeight + reels[i].position;
            
            // Only draw if near the visible area
            if (symbolY > reelY - symbolHeight && symbolY < reelY + reelHeight + symbolHeight) {
                // Draw symbol
                drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, symbol.isSpecial, symbol.scale);
            }
        }
    }
    
    ctx.restore();
}
    // Draw stopped reels
function drawStoppedReels() {
    const reelWidth = (canvas.width - WALL_THICKNESS.left - WALL_THICKNESS.right) / REEL_COUNT;
    const reelHeight = canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom;
    const symbolHeight = reelHeight / SYMBOLS_PER_REEL;
    
    // Draw stopped reels
    for (let i = 0; i < REEL_COUNT; i++) {
        // Only draw if this reel has stopped spinning
        if (reels[i].isSpinning) continue;
        
        const reelX = WALL_THICKNESS.left + i * reelWidth;
        const reelY = WALL_THICKNESS.top;
        
        // Draw symbols
        for (let j = 0; j < reels[i].finalSymbols.length; j++) {
            const symbol = reels[i].finalSymbols[j];
            const symbolData = SYMBOLS.find(s => s.name === symbol.name);
            
            // Calculate position
            const symbolX = reelX;
            const symbolY = reelY + j * symbolHeight;
            
            // Draw symbol
            drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, symbol.isSpecial, symbol.scale);
        }
    }
}

    // Draw a symbol
    function drawSymbol(x, y, width, height, symbol, isSpecial, scale = 1.2) {
        // Calculate center position
        const centerX = x + width / 2;
        const centerY = y + height / 2;

        // Save context for transformations
        ctx.save();
        
        // Check if symbol is defined, if not use a fallback
        if (!symbol) {
            console.warn('Undefined symbol encountered in drawSymbol');
            // Draw a fallback rectangle
            ctx.fillStyle = '#666666';
            ctx.fillRect(x, y, width, height);
            ctx.restore();
            return;
        }
        
        // Apply scaling transformation for special symbols
        if (2 > 1) {
            // Scale from center
            ctx.translate(centerX, centerY);
            // Use a fallback scale if normal_scale is not defined
            const normalScale = symbol.normal_scale || scale || 1.2;
            ctx.scale(normalScale, normalScale);
            ctx.translate(-centerX, -centerY);
        }
        
        // Draw the symbol image
        const img = symbolImages[symbol.name];
        if (img) {
            // Calculate image dimensions to fit within the symbol area
            const imgPadding = width * 0.05;
            const imgSize = Math.min(width, height) - imgPadding * 2;
            
            // Draw the image
            ctx.drawImage(
                img, 
                x + (width - imgSize) / 2, 
                y + (height - imgSize) / 2, 
                imgSize, 
                imgSize
            );
        } else {
            // Fallback if image is not found
            ctx.fillStyle = symbol.color || '#999999';
            ctx.fillRect(
                x + width * 0.1, 
                y + height * 0.1, 
                width * 0.8, 
                height * 0.8
            );
            
            // Draw symbol name as text
            ctx.fillStyle = '#ffffff';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(symbol.name || 'Unknown', centerX, centerY);
        }
        
        // Restore context
        ctx.restore();
    }

// Update the highlightWinningSymbols function to handle the new winning positions format
function highlightWinningSymbols(reelSymbols, winningPositions) {
    // If no winning positions are passed, initialize it as an empty array
    winningPositions = winningPositions || [];
    
    console.log('------------Highlighting winning symbols----------------');
    console.log(winningPositions);
    
    // Track animation frames for scatter symbols
    const scatterFrames = {};
    const spriteScales = {};
    
    // Preload scatter animation frames
    const scatterFrameCount = 61;
    const scatterFrameImages = [];
    let loadedScatterFrames = 0;
    
    for (let i = 0; i <= scatterFrameCount; i++) {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.onload = () => {
            loadedScatterFrames++;
        };
        img.src = `freespinframes/item_${i}.png`;
        scatterFrameImages.push(img);
    }
    
    // Clear previous animations when starting new ones
    activeAnimations = {};
    
    // Loop through winning positions and set up animations
    // The server response format has different structure
    winningPositions.forEach(pos => {
        // Create a unique key for this position
        const key = `${pos.reel}-${pos.row}`;
        
        activeAnimations[key] = {
            symbol: pos.symbol,
            reel: pos.reel,
            row: pos.row,
            startTime: Date.now(),
            active: true,
            // For scatter animations
            currentFrame: 0,
            direction: 1,
            lastUpdateTime: 0,
            frameRate: 25
        };
        
        // Initialize scale tracking for this symbol
        const spriteId = key;
        spriteScales[spriteId] = {
            originalScale: 1.0,
            currentScaleFactor: 1.0
        };
    });
    
    // Create animation frame function
    function animateWinningSymbols() {
        // Check if we have any active animations
        const hasActiveAnimations = Object.values(activeAnimations).some(anim => anim.active);
        
        if (!hasActiveAnimations) {
            return; // Stop animation loop if no active animations
        }
        
        // Redraw the game
        drawGame();
        
        // Request next frame
        requestAnimationFrame(animateWinningSymbols);
    }
    
    // Start animation loop
    if (Object.keys(activeAnimations).length > 0) {
        animateWinningSymbols();
    }
    
    // Override drawStoppedReels to include animations
    const originalDrawStoppedReels = drawStoppedReels;
    drawStoppedReels = function() {
        const reelWidth = (canvas.width - WALL_THICKNESS.left - WALL_THICKNESS.right) / REEL_COUNT;
        const reelHeight = canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom;
        const symbolHeight = reelHeight / SYMBOLS_PER_REEL;
        
        // Draw stopped reels
        for (let i = 0; i < REEL_COUNT; i++) {
            // Only draw if this reel has stopped spinning
            if (reels[i].isSpinning) continue;
            
            const reelX = WALL_THICKNESS.left + i * reelWidth;
            const reelY = WALL_THICKNESS.top;
            
            // Draw symbols
            for (let j = 0; j < reels[i].finalSymbols.length; j++) {
                const symbol = reels[i].finalSymbols[j];
                const symbolData = SYMBOLS.find(s => s.name === symbol.name);
                
                // Calculate position
                const symbolX = reelX;
                const symbolY = reelY + j * symbolHeight;
                
                // Check if this symbol is being animated
                const animKey = `${i}-${j}`;
                const anim = activeAnimations[animKey];
                
                if (anim && anim.active) {
                    // Apply different animations based on symbol type
                    ctx.save();
                    
                    switch (anim.symbol) {
                        case "Scatter":
                            // Frame animation for scatter symbols
                            const now = Date.now();
                            if (now - anim.lastUpdateTime >= anim.frameRate) {
                                anim.lastUpdateTime = now;
                                
                                // Update frame
                                anim.currentFrame += anim.direction;
                                
                                // Reverse direction at the ends
                                if (anim.currentFrame >= scatterFrameCount) {
                                    anim.currentFrame = scatterFrameCount - 2;
                                    anim.direction = -1;
                                } else if (anim.currentFrame < 0) {
                                    anim.currentFrame = 1;
                                    anim.direction = 1;
                                }
                            }
                            
                            // Calculate scale based on current frame position
                            const frameProgress = anim.currentFrame / scatterFrameCount;
                            const maxScaleFactor = 1.3;
                            const scaleFactor = 1.0 + (maxScaleFactor - 1.0) * frameProgress;
                            
                            // Draw the current frame if it's loaded
                            if (loadedScatterFrames > anim.currentFrame) {
                                const frameImg = scatterFrameImages[anim.currentFrame];
                                
                                // Calculate center position for scaling
                                const centerX = symbolX + reelWidth / 2;
                                const centerY = symbolY + symbolHeight / 2;
                                
                                // Apply scaling from center
                                ctx.translate(centerX, centerY);
                                ctx.scale(scaleFactor, scaleFactor);
                                ctx.translate(-centerX, -centerY);
                                
                                // Draw the frame
                                const imgPadding = reelWidth * 0.05;
                                const imgSize = Math.min(reelWidth, symbolHeight) - imgPadding * 2;
                                ctx.drawImage(
                                    frameImg,
                                    symbolX + (reelWidth - imgSize) / 2,
                                    symbolY + (symbolHeight - imgSize) / 2,
                                    imgSize,
                                    imgSize
                                );
                            } else {
                                // Fallback to normal symbol if frames aren't loaded
                                drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, 1.3);
                            }
                            break;
                            
                        // Other symbol animations remain the same...
                        case "Treasure Chest":
                            // Blinking effect
                            if (Math.floor(Date.now() / 100) % 2 === 0) {
                                drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, 1.3);
                            }
                            break;
                            
                        case "Wild":
                            // Frame animation for Wild symbols
                            const wildNow = Date.now();
                            if (wildNow - anim.lastUpdateTime >= 100) { // 100ms frame rate
                                anim.lastUpdateTime = wildNow;
                                
                                // Update frame
                                anim.currentFrame += anim.direction;
                                
                                // Reverse direction at the ends
                                if (anim.currentFrame >= wildFrameCount) {
                                    anim.currentFrame = wildFrameCount - 2;
                                    anim.direction = -1;
                                } else if (anim.currentFrame < 0) {
                                    anim.currentFrame = 1;
                                    anim.direction = 1;
                                }
                            }
                            
                            // Calculate scale based on current frame position
                            const wildFrameProgress = anim.currentFrame / wildFrameCount;
                            const wildMaxScaleFactor = 1.3;
                            const wildScaleFactor = 1.0 + (wildMaxScaleFactor - 1.0) * wildFrameProgress;
                            
                            // Draw the current frame if it's loaded
                            if (loadedWildFrames > anim.currentFrame) {
                                const frameImg = wildFrameImages[anim.currentFrame];
                                
                                // Calculate center position for scaling
                                const centerX = symbolX + reelWidth / 2;
                                const centerY = symbolY + symbolHeight / 2;
                                
                                // Apply scaling from center
                                ctx.translate(centerX, centerY);
                                ctx.scale(wildScaleFactor, wildScaleFactor);
                                ctx.translate(-centerX, -centerY);
                                
                                // Draw the frame
                                const imgPadding = reelWidth * 0.05;
                                const imgSize = Math.min(reelWidth, symbolHeight) - imgPadding * 2;
                                ctx.drawImage(
                                    frameImg,
                                    symbolX + (reelWidth - imgSize) / 2,
                                    symbolY + (symbolHeight - imgSize) / 2,
                                    imgSize,
                                    imgSize
                                );
                            } else {
                                // Fallback to normal symbol if frames aren't loaded
                                drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, 1.3);
                            }
                            break;
                            
                        case "Explorer":
                        case "Compass":
                        case "Binoculars":
                            // Rotating effect
                            ctx.translate(symbolX + reelWidth/2, symbolY + symbolHeight/2);
                            ctx.rotate(Math.sin(Date.now() / 300) * 0.1);
                            ctx.translate(-(symbolX + reelWidth/2), -(symbolY + symbolHeight/2));
                            drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, 1.2);
                            break;
                            
                        case "A":
                        case "K":
                        case "Q":
                        case "J":
                            // Blinking effect
                            if (Math.floor(Date.now() / 450) % 2 === 0) {
                                drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, 1.15);
                            }
                            break;

                        default:
                            // Pulsing effect for other symbols
                            const pulseFactor = 1.0 + 0.1 * Math.sin(Date.now() / 200);
                            drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, true, pulseFactor);
                            break;
                    }
                    
                    ctx.restore();
                } else {
                    // Draw normal symbol
                    drawSymbol(symbolX, symbolY, reelWidth, symbolHeight, symbolData, symbol.isSpecial, symbol.scale);
                }
            }
        }
    };
}

// Draw win display
function drawWinDisplay() {
    // Update win amount display
    document.getElementById('update_winnings').textContent = winAmount.toFixed(2);
}

// Spin the reels
function spin() {
    // Check if already spinning
    if (spinning) return;
    
    // Check if in free spin mode and waiting for user to start
    if (freeSpinTriggeredRecently) {
        startFreeSpinsOverlay.style.display = "block";
        return;
    }
    
    // Check if we have enough balance
    if (!isFreeSpinMode && balance < stake) {
        // Not enough balance
        alert("Not enough balance to spin!");
        return;
    }
    
    // Reset win amount
    winAmount = 0;
    document.getElementById('update_winnings').textContent = '0.00';
    
    // Hide win message
    winMessageElement.style.display = 'none';
    
    // Deduct stake from balance if not in free spin mode
    if (!isFreeSpinMode) {
        balance -= stake;
        displayBalance(balance);
    } else {
        // Update free spins count
        remainingFreeSpinCount--;
        freeSpinsCountElement.textContent = remainingFreeSpinCount;
    }
    
    // Set spinning state
    spinning = true;
    
    // Rotate spin button image
    rotateSpinButtonImage();
    
    // Play spin sound
    if (soundEffectsEnabled) {
        spinSound.currentTime = 0;
        spinSound.play().catch(e => console.log("Audio play failed:", e));
        
        // Play reel speed up sound
        reelSpeedUpSound.currentTime = 0;
        reelSpeedUpSound.play().catch(e => console.log("Audio play failed:", e));
    }
    
    // Set all reels to spinning
    for (let i = 0; i < REEL_COUNT; i++) {
        reels[i].isSpinning = true;
        reels[i].position = 0;
    }
    
    // Generate new symbols for each reel
    for (let i = 0; i < REEL_COUNT; i++) {
        // Generate new symbols (visible + extra for scrolling)
        const totalSymbols = SYMBOLS_PER_REEL + EXTRA_SYMBOLS * 2;
        reels[i].symbols = [];
        
        for (let j = 0; j < totalSymbols; j++) {
            const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
            random_symbol_name = SYMBOLS[randomIndex].name
            reels[i].symbols.push({
                name: random_symbol_name,
                isSpecial: true,
                scale: SYMBOL_SCALE_MAP[random_symbol_name] // Random scale between 1.1 and 1.6
            });
        }
    }
    
    // Determine final results
    finalResults = [];
    
    // Check if this is a demo feature spin
    if (currentDemoFeature.feature === "big spin") {
        // Big spin feature - show a big win
        finalResults = generateBigWinResults();
        currentDemoFeature.feature = "normal spin"; // Reset to normal for next spin
    } else if (currentDemoFeature.feature === "big win") {
        // Big win feature - show a big win animation
        finalResults = generateBigWinResults();
        currentDemoFeature.feature = "normal spin"; // Reset to normal for next spin
    } else if (currentDemoFeature.feature === "free spins") {
        // Free spins feature - trigger free spins
        finalResults = generateFreeSpinsResults();
        currentDemoFeature.feature = "normal spin"; // Reset to normal for next spin
    } else {
        // Normal spin - random results
        for (let i = 0; i < REEL_COUNT; i++) {
            const reelResult = [];
            for (let j = 0; j < SYMBOLS_PER_REEL; j++) {
                const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
                
                // Limit Wild symbols to reels 2, 3, 4, and 5
                if (SYMBOLS[randomIndex].name === 'Wild' && i === 0) {
                    // Replace Wild with another symbol on reel 1
                    let newIndex;
                    do {
                        newIndex = Math.floor(Math.random() * SYMBOLS.length);
                    } while (SYMBOLS[newIndex].name === 'Wild');
                    
                    reelResult.push({
                        name: SYMBOLS[newIndex].name,
                        isSpecial: true,
                        scale: SYMBOL_SCALE_MAP[SYMBOLS[newIndex].name]
                    });
                } else {
                    reelResult.push({
                        name: SYMBOLS[randomIndex].name,
                        isSpecial: true,
                        scale: SYMBOL_SCALE_MAP[SYMBOLS[randomIndex].name]
                    });
                }
            }
            finalResults.push(reelResult);
        }
    }
    
    // Set final symbols for each reel
    for (let i = 0; i < REEL_COUNT; i++) {
        reels[i].finalSymbols = finalResults[i];
    }
    
    // Start animation
    animateReels();
}

// Generate results for a big win
function generateBigWinResults() {
    const results = [];
    
    // Choose a high-paying symbol
    const highPayingSymbols = ['Treasure Chest', 'Explorer', 'Compass'];
    const selectedSymbol = highPayingSymbols[Math.floor(Math.random() * highPayingSymbols.length)];
    
    // Fill first 3 reels with the selected symbol
    for (let i = 0; i < 3; i++) {
        const reelResult = [];
        for (let j = 0; j < SYMBOLS_PER_REEL; j++) {
            reelResult.push({
                name: selectedSymbol,
                isSpecial: true,
                scale: SYMBOL_SCALE_MAP[selectedSymbol]
            });
        }
        results.push(reelResult);
    }
    
    // Fill remaining reels with random symbols
    for (let i = 3; i < REEL_COUNT; i++) {
        const reelResult = [];
        for (let j = 0; j < SYMBOLS_PER_REEL; j++) {
            const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
            
            // Add some Wilds to increase win chances
            if (Math.random() < 0.5) {
                reelResult.push({
                    name: 'Wild',
                    isSpecial: true,
                    scale: SYMBOL_SCALE_MAP['Wild']
                });
            } else {
                reelResult.push({
                    name: SYMBOLS[randomIndex].name,
                    isSpecial: true,
                    scale: SYMBOL_SCALE_MAP[SYMBOLS[randomIndex].name]
                });
            }
        }
        results.push(reelResult);
    }
    
    return results;
}

// Generate results for free spins
function generateFreeSpinsResults() {
    const results = [];
    
    // Ensure at least one scatter on each reel
    for (let i = 0; i < REEL_COUNT; i++) {
        const reelResult = [];
        
        // Add one scatter
        reelResult.push({
            name: 'Scatter',
            isSpecial: true,
            scale: SYMBOL_SCALE_MAP['Scatter']
        });
        
        // Fill the rest with random symbols
        for (let j = 1; j < SYMBOLS_PER_REEL; j++) {
            const randomIndex = Math.floor(Math.random() * (SYMBOLS.length - 1)); // Exclude scatter
            
            reelResult.push({
                name: SYMBOLS[randomIndex].name,
                isSpecial: true,
                scale: SYMBOL_SCALE_MAP[SYMBOLS[randomIndex].name]
            });
        }
        
        // Shuffle the reel to randomize scatter position
        for (let j = reelResult.length - 1; j > 0; j--) {
            const k = Math.floor(Math.random() * (j + 1));
            [reelResult[j], reelResult[k]] = [reelResult[k], reelResult[j]];
        }
        
        results.push(reelResult);
    }
    
    return results;
}

// Animate the reels
function animateReels() {
    // Calculate the total distance each reel needs to travel
    const reelHeight = canvas.height - WALL_THICKNESS.top - WALL_THICKNESS.bottom;
    const symbolHeight = reelHeight / SYMBOLS_PER_REEL;
    const totalDistance = symbolHeight * (SYMBOLS_PER_REEL + EXTRA_SYMBOLS * 2);
    
    // Set up animation parameters
    const baseSpinDuration = isQuickSpinMode ? 1000 : 2000; // Base duration in ms
    const reelDelay = isQuickSpinMode ? 100 : 200; // Delay between reels stopping in ms
    
    // Start time for animation
    const startTime = Date.now();
    
    // Animation function
    function animate() {
        const currentTime = Date.now();
        const elapsedTime = currentTime - startTime;
        
        // Update each reel
        let allReelsStopped = true;
        
        for (let i = 0; i < REEL_COUNT; i++) {
            // Only animate if this reel is still spinning
            if (!reels[i].isSpinning) continue;
            
            // Calculate when this reel should stop
            const reelStopTime = baseSpinDuration + i * reelDelay;
            
            if (elapsedTime >= reelStopTime) {
                // This reel should stop
                reels[i].isSpinning = false;
                reels[i].position = 0; // Reset position
                
                // Play reel stop sound
                if (soundEffectsEnabled && i === REEL_COUNT - 1) {
                    // Stop reel speed up sound when last reel stops
                    reelSpeedUpSound.pause();
                    reelSpeedUpSound.currentTime = 0;
                }
            } else {
                // This reel is still spinning
                allReelsStopped = false;
                
                // Calculate progress (0 to 1)
                const reelProgress = Math.min(elapsedTime / reelStopTime, 1);
                
                // Use easing function for smooth animation
                const easedProgress = easeInOutQuad(reelProgress);
                
                // Calculate position
                reels[i].position = easedProgress * totalDistance % symbolHeight;
            }
        }
        
        // Redraw the game
        drawGame();
        
        // Continue animation if any reels are still spinning
        if (!allReelsStopped) {
            requestAnimationFrame(animate);
        } else {
            // All reels have stopped
            spinning = false;
            
            // Reset spin button image
            resetSpinButtonImage();
            
            // Calculate win
            calculateWin();
            
            // Check for free spins trigger
            checkForFreeSpins();
            
            // Continue auto spins if enabled
            if (autoSpins > 0 && !autoSpinsStopped && !freeSpinTriggeredRecently) {
                // Decrement auto spins counter
                autoSpins--;
                
                // Update display
                if (autoSpins > 0) {
                    remainingAutoSpins.innerHTML = autoSpins;
                } else {
                    remainingAutoSpins.innerHTML = '';
                    autoSpinsStopped = true;
                    updateAutoSpinStatus();
                }
                
                // Check loss limit
                if (lossLimit !== Infinity) {
                    const currentLoss = initialBalance - balance;
                    const maxAllowedLoss = stake * lossLimit;
                    
                    if (currentLoss >= maxAllowedLoss) {
                        // Stop auto spins due to loss limit
                        autoSpins = 0;
                        remainingAutoSpins.innerHTML = '';
                        autoSpinsStopped = true;
                        updateAutoSpinStatus();
                        alert("Auto spins stopped: Loss limit reached");
                        return;
                    }
                }
                
                // Spin again after a delay
                setTimeout(() => {
                    if (isFreeSpinMode) {
                        // In free spin mode, spin automatically
                        spin();
                    } else if (autoSpins > 0 && !autoSpinsStopped) {
                        spin();
                    }
                }, 1000);
            } else if (isFreeSpinMode && remainingFreeSpinCount > 0 && !freeSpinTriggeredRecently) {
                // Continue free spins automatically after a delay
                setTimeout(() => {
                    spin();
                }, 1000);
            } else if (remainingFreeSpinCount === 0 && isFreeSpinMode) {
                // Free spins have ended
                endFreeSpins();
            }
        }
    }
    
    // Easing function for smooth animation
    function easeInOutQuad(t) {
        return t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t;
    }

    // Calculate win
    function calculateWin() {
        // Reset win amount
        winAmount = 0;
        
        // Extract symbol names from final results
        const symbolGrid = [];
        for (let row = 0; row < SYMBOLS_PER_REEL; row++) {
            const rowSymbols = [];
            for (let reel = 0; reel < REEL_COUNT; reel++) {
                rowSymbols.push(finalResults[reel][row].name);
            }
            symbolGrid.push(rowSymbols);
        }
        
        // Check for wins on each payline (243 ways)
        const winningPositions = [];
        
        // Check for scatter wins (any position)
        let scatterCount = 0;
        const scatterPositions = [];
        
        for (let reel = 0; reel < REEL_COUNT; reel++) {
            for (let row = 0; row < SYMBOLS_PER_REEL; row++) {
                if (symbolGrid[row][reel] === 'Scatter') {
                    scatterCount++;
                    scatterPositions.push({ reel, row, symbol: 'Scatter' });
                }
            }
        }
        
        // Calculate scatter win
        if (scatterCount >= 3) {
            const scatterSymbol = SYMBOLS.find(s => s.name === 'Scatter');
            const scatterPayout = scatterSymbol.payouts[scatterCount - 1] || 0;
            winAmount += scatterPayout * stake;
            
            // Add scatter positions to winning positions
            winningPositions.push(...scatterPositions);
        }
        
        // Check for wins on each row (left to right)
        for (let startRow = 0; startRow < SYMBOLS_PER_REEL; startRow++) {
            // For each symbol in the first reel
            const firstReelSymbol = symbolGrid[startRow][0];
            
            // Skip scatter as it's already handled
            if (firstReelSymbol === 'Scatter') continue;
            
            // Track current winning sequence
            let currentWin = {
                symbol: firstReelSymbol,
                count: 1,
                positions: [{ reel: 0, row: startRow, symbol: firstReelSymbol }]
            };
            
            // Check subsequent reels
            for (let reel = 1; reel < REEL_COUNT; reel++) {
                let foundMatch = false;
                
                // Check all positions in this reel
                for (let row = 0; row < SYMBOLS_PER_REEL; row++) {
                    const currentSymbol = symbolGrid[row][reel];
                    
                    // Match if same symbol or Wild (except for first reel)
                    if (currentSymbol === currentWin.symbol || 
                        (currentSymbol === 'Wild' && currentWin.symbol !== 'Scatter')) {
                        foundMatch = true;
                        currentWin.positions.push({ reel, row, symbol: currentSymbol });
                        break; // Only need one match per reel
                    }
                }
                
                // If no match found, break the sequence
                if (!foundMatch) {
                    break;
                }
                
                // Increment count if match found
                currentWin.count++;
            }
            
            // Calculate win amount if sequence is at least 3 symbols
            if (currentWin.count >= 3) {
                const winSymbol = SYMBOLS.find(s => s.name === currentWin.symbol);
                if (winSymbol) {
                    const payout = winSymbol.payouts[currentWin.count - 1] || 0;
                    winAmount += payout * stake;
                    
                    // Add positions to winning positions
                    winningPositions.push(...currentWin.positions);
                }
            }
        }
        
        // Apply bonus multiplier in free spin mode
        if (isFreeSpinMode && bonusMultiplier > 0) {
            winAmount *= bonusMultiplier;
        }
        
        // Update balance
        balance += winAmount;
        displayBalance(balance);
        
        // Update win display
        document.getElementById('update_winnings').textContent = winAmount.toFixed(2);
        
        // Show win message for significant wins
        if (winAmount >= stake * 10) {
            winMessageElement.style.display = 'block';
            winAmountElement.textContent = winAmount.toFixed(2);
            
            // Play win sound
            if (soundEffectsEnabled) {
                winSound.currentTime = 0;
                winSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Show big win animation for larger wins
            if (winAmount >= stake * 50) {
                showBigWinAnimation(winAmount);
            }
        }
        
        // Highlight winning symbols
        if (winningPositions.length > 0) {
            highlightWinningSymbols(finalResults, winningPositions);
        }
    }

    // Check for free spins trigger
    function checkForFreeSpins() {
        // Count scatters on each reel
        const scatterOnReel = Array(REEL_COUNT).fill(false);
        let totalScatters = 0;
        
        for (let reel = 0; reel < REEL_COUNT; reel++) {
            for (let row = 0; row < SYMBOLS_PER_REEL; row++) {
                if (finalResults[reel][row].name === 'Scatter') {
                    scatterOnReel[reel] = true;
                    totalScatters++;
                }
            }
        }
        
        // Check if we have at least one scatter on each reel
        const hasScatterOnEachReel = scatterOnReel.every(has => has);
        
        if (hasScatterOnEachReel) {
            // Trigger free spins
            freeSpinTriggeredRecently = true;
            
            // Determine bonus multiplier based on total scatters
            let newBonusMultiplier = 0;
            
            if (totalScatters >= 10) {
                newBonusMultiplier = 72;
            } else if (totalScatters >= 9) {
                newBonusMultiplier = 36;
            } else if (totalScatters >= 8) {
                newBonusMultiplier = 24;
            } else if (totalScatters >= 7) {
                newBonusMultiplier = 12;
            } else if (totalScatters >= 6) {
                newBonusMultiplier = 6;
            } else if (totalScatters >= 5) {
                newBonusMultiplier = 3;
            }
            
            // If already in free spin mode, add more free spins
            if (isFreeSpinMode) {
                // Add 13 more free spins, up to a maximum of 100
                const additionalSpins = 13;
                const newTotal = Math.min(remainingFreeSpinCount + additionalSpins, 100);
                const actualAdded = newTotal - remainingFreeSpinCount;
                
                remainingFreeSpinCount = newTotal;
                freeSpinCount = newTotal;
                
                // Update display
                freeSpinsCountElement.textContent = remainingFreeSpinCount;
                
                // Show additional free spins message
                freeSpinsOverlayImg.style.display = "none";
                freeSpinsOverlayImg2.style.display = "block";
                freeSpinsOverlay.style.display = "block";
                
                // Hide after a delay
                setTimeout(() => {
                    freeSpinsOverlay.style.display = "none";
                    freeSpinsOverlayImg.style.display = "block";
                    freeSpinsOverlayImg2.style.display = "none";
                    freeSpinTriggeredRecently = false;
                }, 3000);
        } else {
            // Start new free spins session
            freeSpinCount = 13;
            remainingFreeSpinCount = 13;
            bonusMultiplier = newBonusMultiplier;
            originalBetAmount = stake;
            
            // Show free spins overlay
            freeSpinsOverlay.style.display = "block";
            
            // Hide after a delay
            setTimeout(() => {
                freeSpinsOverlay.style.display = "none";
                startFreeSpinsOverlay.style.display = "block";
            }, 3000);
        }
    }
}

// Start free spins
function startFreeSpins() {
    // Hide overlay
    startFreeSpinsOverlay.style.display = "none";
    
    // Set free spin mode
    isFreeSpinMode = true;
    freeSpinTriggeredRecently = false;
    
    // Show free spins indicator
    freeSpinsIndicator.style.display = "block";
    freeSpinsCountElement.textContent = remainingFreeSpinCount;
    bonusMultiplierElement.textContent = bonusMultiplier;
    
    // Change background image for free spins
    document.getElementById('img_top').style.display = "none";
    document.getElementById('img_top_volcano_part_1').style.display = "block";
    
    // Play free spin sound
    if (soundEffectsEnabled) {
        // Pause background music
        backgroundMusic.pause();
        
        // Play free spin sound
        freeSpinSound.currentTime = 0;
        freeSpinSound.play().catch(e => console.log("Audio play failed:", e));
    }
    
    // Start spinning
    spin();
}

// End free spins
function endFreeSpins() {
    // Reset free spin mode
    isFreeSpinMode = false;
    freeSpinTriggeredRecently = false;
    
    // Hide free spins indicator
    freeSpinsIndicator.style.display = "none";
    
    // Reset background image
    document.getElementById('img_top').style.display = "block";
    document.getElementById('img_top_volcano_part_1').style.display = "none";
    document.getElementById('img_top_volcano_part_2').style.display = "none";
    
    // Stop free spin sound and resume background music
    if (soundEffectsEnabled) {
        freeSpinSound.pause();
        freeSpinSound.currentTime = 0;
        
        if (backgroundMusicEnabled) {
            backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
        }
    }
    
    // Redraw game to update walls
    drawGame();
}

// Show big win animation
function showBigWinAnimation(amount) {
    // Determine win level
    let winLevel;
    const winMultiplier = amount / stake;
    
    if (winMultiplier >= winLevels.ultra.threshold) {
        winLevel = winLevels.ultra;
    } else if (winMultiplier >= winLevels.mega.threshold) {
        winLevel = winLevels.mega;
    } else {
        winLevel = winLevels.big;
    }
    
    // Set up win overlay
    const winText = document.getElementById('winText');
    const winAmount = document.getElementById('winAmount');
    const sunburst = document.getElementById('sunburst');
    const winOverlay = document.getElementById('winOverlay');
    const coinsContainer = document.getElementById('coinsContainer');
    
    // Clear previous coins
    coinsContainer.innerHTML = '';
    
    // Set win text and class
    winText.textContent = winLevel.text;
    winText.className = `win-text ${winLevel.textClass}`;
    
    // Set sunburst class
    sunburst.className = `sunburst ${winLevel.sunburstClass}`;
    
    // Initialize win amount counter
    let currentAmount = 0;
    const duration = 3000; // 3 seconds
    const startTime = Date.now();
    
    // Show overlay with scale-in animation
    winOverlay.style.display = 'flex';
    winText.classList.add('scale-in');
    
    // Play big win sound
    if (soundEffectsEnabled) {
        // Pause other sounds
        backgroundMusic.pause();
        freeSpinSound.pause();
        
        // Play big win sound
        bigWinSound.currentTime = 0;
        bigWinSound.play().catch(e => console.log("Audio play failed:", e));
    }
    
    // Create coins
    for (let i = 0; i < winLevel.coinCount; i++) {
        createCoin(coinsContainer);
    }
    
    // Animate win amount counter
    function updateCounter() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Use easing function for smooth animation
        const easedProgress = easeOutQuart(progress);
        currentAmount = easedProgress * amount;
        
        // Update display
        winAmount.textContent = '$' + currentAmount.toFixed(2);
        
        // Continue animation if not complete
        if (progress < 1) {
            requestAnimationFrame(updateCounter);
        }
    }
    
    // Start counter animation
    updateCounter();
}

// Create a coin element for win animation
function createCoin(container) {
    const coin = document.createElement('img');
    coin.className = 'coin';
    
    // Randomly select a coin image
    const randomIndex = Math.floor(Math.random() * coinImages.length);
    coin.src = coinImages[randomIndex];
    
    // Random size between 30 and 60 pixels
    const size = Math.random() * 30 + 30;
    coin.style.width = `${size}px`;
    coin.style.height = `${size}px`;
    
    // Random starting position
    const startX = Math.random() * container.clientWidth;
    const startY = container.clientHeight + size;
    
    // Random horizontal velocity
    const vx = (Math.random() - 0.5) * 2;
    
    // Random vertical velocity (upward)
    const vy = -Math.random() * 5 - 10;
    
    // Random rotation
    const rotation = Math.random() * 360;
    coin.style.transform = `rotate(${rotation}deg)`;
    
    // Set initial position
    coin.style.left = `${startX}px`;
    coin.style.top = `${startY}px`;
    
    // Add to container
    container.appendChild(coin);
    
    // Animation variables
    let x = startX;
    let y = startY;
    let velocityX = vx;
    let velocityY = vy;
    const gravity = 0.2;
    
    // Animate the coin
    function animateCoin() {
        // Update position
        velocityY += gravity;
        x += velocityX;
        y += velocityY;
        
        // Bounce off walls
        if (x < 0 || x > container.clientWidth - size) {
            velocityX *= -0.8;
            x = Math.max(0, Math.min(x, container.clientWidth - size));
        }
        
        // Remove if off bottom
        if (y > container.clientHeight + size) {
            coin.remove();
            return;
        }
        
        // Update position
        coin.style.left = `${x}px`;
        coin.style.top = `${y}px`;
        
        // Continue animation
        requestAnimationFrame(animateCoin);
    }
    
    // Start animation
    animateCoin();
}

// Easing function for smooth animation
function easeOutQuart(t) {
    return 1 - Math.pow(1 - t, 4);
}

// Initialize the game
window.onload = function() {
    // Show loading screen
    initLoading();
    
    // Preload images
    preloadImages();
    
    // Preload wild frames
    preloadWildFrames();
};
</script>
</body>
</html>
