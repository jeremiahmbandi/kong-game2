<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kong (Treasure Hunt) Slot Machine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Andada+Pro:ital,wght@0,400..840;1,400..840&family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Victor+Mono:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #2c2c2c;
            touch-action: manipulation;
        }
        @font-face {
            font-family: 'aldo';
            src: url('aldo_the_apache') format('truetype'); /* Adjust the path and format */
        }

            

        #game-container {
            width: 100%;
            height: 100vh;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'aldo', sans-serif;
        }
        .game-canvas-container {
            flex: 1;
            position: relative;
            height: 100%;
            width: 96%;
            margin: auto;
            overflow: hidden;
            z-index: 888;
        }
        .game-controls {
            margin: 0px !important;
            padding: 0px !important;
            width: 100%;
            background-image: url('wood.jpg');
            border-radius: 12px 12px 0 0;
            z-index: 1000;
            bottom: 0 !important;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .spin-button, .autoplay-button {
            cursor: pointer;
            width: 100%;
            text-align: center;
            padding: 12px;
        }
        /* Responsive adjustments */
        @media (max-height: 600px) {
            .game-controls {
                padding: 5px;
            }
            .control-group {
                gap: 5px;
            }
            .input-group {
                margin-bottom: 5px;
            }
        }
        /* Prevent text selection */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Allow input in number fields */
        input[type="number"] {
            -webkit-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }
        /* #gameinfo_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: black;
            z-index: 2002;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: auto;
            display: none;
        } */
        #jdb_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index: 2002;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        #kong_overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('kong_bcg4.png');
            background-size:cover;
            background-repeat: repeat;
            background-color: black;
            z-index: 2001;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        /* Stake button and overlay styles */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 1);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .overlay-content {
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            margin-top: 100px;
        }
        .overlay-content-stake {
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            padding: 20px;
            margin-top: 100px;
        }
        .overlay-header {
            color: #e4d594;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .option-button {
            background: linear-gradient(to bottom, #353333, #272525);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 0;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option-button:hover, .option-button.selected {
            background-color: #25282b;
            box-shadow: 
                inset 0 0 0 2px rgba(0, 0, 0, 0.15),
                0 0 0 2px rgba(0, 0, 0, 0.15),
                inset 0 0 0.875rem #FCEAAC,
                0 0 0.875rem #FCEAAC;
        }
        .overlay-footer {
            width: inherit;
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-bottom: 50px;
            bottom: 0;
            position:absolute;
        }
        .overlay-footer-stake {
            margin-top: 20px;
            padding-bottom: 50px;
            bottom: 0;
            position:absolute;
        }
        .overlay-footer button {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
        }
        .cancel-button {
            background-color: #333;
            color: white;
        }
        .confirm-button {
            background-color: #333;
            box-shadow: 0 0 4px #e4d594;
            color: white;
        }
        .divider-container {
            color: #e4d594;
        }
        .divider {
            height: 2px;
            background-color: #e4d594;
            width: 30vw;
        }
        .divider-text {
            margin: 0 10px;
        }
        .divider-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            margin: 16px 0;
        }
        .check-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-left: 4px;
            position: relative;
        }
        .check-icon:before {
            content: '';
            position: absolute;
            width: 8px;
            height: 12px;
            border-right: 2px solid white;
            border-bottom: 2px solid white;
            transform: rotate(45deg);
            top: 0;
            left: 4px;
        }
        
        .victor-mono {
            font-family: "Victor Mono", monospace;
            font-optical-sizing: auto;
            font-weight: normal;
            font-style: normal;
        }

        /* Settings overlay styles */
        .sound-option {
            color: white;
        }
        .icon-container {
            font-size: 1.5rem;
            display: inline-block;
            width: 30px;
            text-align: center;
        }
        .loader-container {
            height: 10px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
        }
        .loader-bar {
            height: 100%;
            width: 0;
            background: orange;
            transition: width 0.3s ease;
        }
        .glowing-button {
            position: absolute; /* Ensure ::after is positioned relative to this */
            bottom: 9%;
            padding: 6px 50px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            border-radius: 12px;
            border-width: 5px;
            border-style: solid;
            border-color: #c09c0e;
            background-color: #fada60;
            font-weight: bold;
            text-shadow: 
                -1px -1px 0 orange,  
                1px -1px 0 orange,
                -1px  1px 0 orange,
                1px  1px 0 orange;
            overflow: hidden; /* Prevents the light effect from overflowing */
        }

        /* Light reflection effect */
        .glowing-button::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 200%; /* Reduce width to prevent excessive overflow */
            height: 100%;
            background: linear-gradient(
                100deg,
                rgba(255, 255, 255, 0) 40%,
                rgba(255, 255, 255, 0.4) 50%,
                rgba(255, 255, 255, 0) 60%
            );
            animation: light-sweep 2s infinite linear;
        }

        @keyframes light-sweep {
            0% {
                left: -100%;
            }
            100% {
                left: 100%;
            }
        }

        /* Free spins indicator */
        .free-spins-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(192, 156, 14, 0.8);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 1.0rem;
            font-weight: bold;
            z-index: 100;
            display: none;
        }

        /* Win message */
        .win-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: #fada60;
            padding: 15px 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            animation: bounce 1s infinite;
            z-index: 100;
            display: none;
        }
    </style>
    <style>
        .mobile-wrapper {
            max-width: 100vw;
            max-height: 100vh;
        }
        .autoplay-button, .stake-button{
            height: 80px;
            width: 80px;
        }
        .spin-img{
            height: 65px;
            width: 65px;
        }
        .spin-button{
            height: 100px;
            width: 100px;
        }
        .autospininner-img{
            height: 40px;
            width: 40px;
        }
        .totalbetinner-img{
            height: 25px;
        }
        .current-stake{
            font-size: 1.2rem;
            color: #f6d64e;
        }
        #playground{
            height: 35vh;
        }
        .fs-text-image{
            max-height: 25px;
        }
        #remaining_fs_holder, #total_fs_holder{
            color: #8cc904;
            font-size: 2.0rem;
            font-weight: bold;
        }

        @media screen and (min-width: 900px) {
            .sunburst-container {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 80vw;
                max-width: 600px;
                height: 80vw;
                max-height: 600px;
                z-index: 10; /* Higher than coins */
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: visible;
                pointer-events: none;
            }
            /* #gameinfo_overlay {
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                left: 50%;
                transform: translate(-50%, -0%);
                background-color: black;
                z-index: 2002;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                display: none;
                position: relative;
                overflow: auto;
            } */
            #jdb_overlay {
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-color: black;
                z-index: 2002;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            #kong_overlay {
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-image: url('kong_bcg5.png');
                background-size:contain;
                background-repeat: no-repeat;
                background-color: black;
                z-index: 2001;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            .overlay {
                position: absolute;
                max-width: 320px;
                max-height: 5100px;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                left: 50%;
                transform: translate(-50%, -0%);
                background-color: rgba(0, 0, 0, 1);
                z-index: 2000;
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            #playground{
                max-height: 200px;
                width: 100%;
            }
            .mobile-wrapper {
                max-width: 320px;
                max-height: 490px;
            }
            .autoplay-button, .stake-button{
                height: 55px;
                width: 55px;
            }
            .spin-img{
                height: 45px;
                width: 45px;
            }
            .spin-button{
                height: 70px;
                width: 70px;
            }
            .autospininner-img{
                height: 30px;
                width: 30px;
            }
            .totalbetinner-img{
                height:21px
            }
            .current-stake{
                font-size: 1.0rem;
                color: #f6d64e;
            }
            .fs-text-image{
                max-height: 20px;
            }
            #remaining_fs_holder, #total_fs_holder{
                color: #8cc904;
                font-size: 1.5rem;
                font-weight: bold;
            }
        }
    </style>

<style>
    .btn-gold {
      background-color: #b8860b;
      color: white;
      border: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    .btn-gold:hover {
      background-color: #a67c00;
      color: white;
    }

    #winOverlay{
        position: absolute;
        width: 100%;
        min-height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }


    #closeBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      z-index: 20;
    }

    .win-content {
      position: relative;
      text-align: center;
      z-index: 15;
    }

    /* Rotating sunburst effect */
    .sunburst-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100vw;
      max-width: 600px;
      height: 80vw;
      max-height: 600px;
      z-index: 10; /* Higher than coins */
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: visible;
      pointer-events: none;
    }

    .sunburst {
      width: 100%;
      height: 100%;
      background-image: url('https://hebbkx1anhila5yf.public.blob.vercel-storage.com/BigWin_FX-pnFZvgsE0rjtfTiTODDEY1oM6AHQJ4.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: rotate 10s linear infinite;
    }

    /* Colored overlays for different win levels */
    .big-win-color {
      filter: none;
    }

    .mega-win-color {
      filter: none; /* Original gold/yellow color */
    }

    .ultra-win-color {
      filter: none;
    }

    @keyframes rotate {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .win-text {
      font-size: calc(2rem + 2vw);
      font-weight: bold;
      margin-bottom: 16px;
      text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
      animation: text-flicker 2s infinite;
      transition: color 0.5s, transform 0.5s;
      position: relative;
      z-index: 20;
    }

    .counter-text {
      font-size: calc(0.5rem + 2vw);
      font-weight: bold;
      color: #a67c00;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 0 0 20px rgba(255, 215, 0, 0.5);
      animation: pulse 1.5s infinite;
      position: relative;
      z-index: 20;
    }

    #coinsContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      pointer-events: none;
      z-index: 5; /* Lower than sunburst */
    }

    .coin {
      position: absolute;
      filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.7));
      transition: transform 0.05s ease-out;
      z-index: 5; /* Lower than sunburst */
    }

    /* Win level styles */
    .big-win {
      color: #ffd700;
    }

    .mega-win {
      color: #ffd700;
    }

    .ultra-win {
      color: #ffd700;
    }

    @keyframes text-flicker {
      0%, 100% {
        opacity: 1;
        text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
      }
      50% {
        opacity: 0.9;
        text-shadow: 0 0 15px currentColor, 0 0 25px currentColor;
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    @keyframes scale-in {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .scale-in {
      animation: scale-in 0.5s forwards;
    }

    /* Responsive adjustments */
    @media (max-width: 576px) {
      .btn-group {
        flex-direction: column;
        width: 100%;
      }
      
      .btn-group .btn {
        margin-bottom: 0.5rem;
        width: 100%;
      }
      
      .win-text {
        font-size: calc(1.5rem + 2vw);
      }
      
      .counter-text {
        font-size: calc(1em + 2vw);
      }
    }
  </style>

</head>
<body class=" w-100">
<div class="container" style="background-image: url('page_bcg.png');background-size: cover;height: 100vh;padding: 0 !important;">
    
    <div class="mobile-wrapper mx-auto" >

        <div id="gameinfo_overlay" class="overlay" style="max-height: 100vh !important;overflow-y: scroll;overflow-x: hidden;">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider-text">GAME RULE</div>
                </div>
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <div style="width: 90%;background-color: #e4d594;height: 5px;"></div>
            </div>
            <div class="" style="color: white;">
                <div style="border: 1px;border-color: #e4d594;font-size: 1.0rem;border-style: solid;" class="py-4 mx-3 d-flex justify-content-center align-items-around my-3">
                    <div class="px-2">
                        <span style="color: #e4d594;"> Denomination:</span> 0.01
                    </div>
                    <div class="px-2">
                        <span style="color: #e4d594;">Bet Multiplier:</span> 1
                    </div>
                </div>
                <div class="row px-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4">
                        <img src="wild.png" style="max-width: 100px;" alt="">
                        <div>WILD</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12">
                        ONLY APPEARS ON REELS 2,3,4 AND 5.
                        <br>
                        <br>
                        <div class="d-flex justify-content-start align-items-center">
                            SUBSTITUTES FOR ALL SYMBOLS EXCEPT <img style="width: 40px;height: auto;" src="treasurechest.png" alt="">
                        </div>
                    </div>
                </div>
    
    
                <div class="row px-3 my-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4">
                        <img src="treasurechest.png" style="max-width: 100px;" alt="">
                        <div>FREE SPIN BONUS</div>
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12">
                        APPEARS ON ALL REELS
                        <br>
                        <div class="">
                            IF ATLEAST ONE <img style="width: 40px;height: auto;" src="treasurechest.png" alt=""> APPEARS ON ALL REELS FREE SPIN BONUS WITH 13 FREE SPINS AND A BONUS MULTIPLIER WILL BE TRIGGERED 
                        </div>
    
                        <div class="mt-4">
                            <div class="my-1">
                                5 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 3X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                6 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 6X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                7 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 12X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                8 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 24X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                9 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 36X BONUS MULTIPLIER
                            </div>
                            <div class="my-1">
                                10 <img style="width: 40px;height: auto;" class="px-1" src="treasurechest.png" alt=""> AWARD 72X BONUS MULTIPLIER
                            </div>
                        </div>
                    </div>
                </div>
    
                <div class="divider-container">
                    <div class="divider-wrapper">
                        <div class="divider-text" style="font-weight: bold;">PAYTABLE</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
    
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="scatter.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 250
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 40
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="explorer.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 200
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 30
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="compass.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 175
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 60
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 25
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="binoculars.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 150
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 50
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 20
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="a.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 20
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 10
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="k.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 90
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 15
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 8
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="q.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 12
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 6
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="j.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 70
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 10
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 5
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2" style="visibility: hidden;">
                        
                    </div>
                </div>
    
                <div style="font-size: 1.0rem;" class="text-center">
                    <div class="my-1">
                        ALL WINS PAY LEFTMOST TO RIGHT, EXCEPT <img src="treasurechest.png" style="max-width: 40px;" alt="">
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN FOR BET MULTIPLIER X1.
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN IN CREDITS
                    </div>
                </div>
    
                <div class="divider-container mt-5">
                    <div class="divider-wrapper">
                        <div class="divider-text" style="font-weight: bold;">FREE SPIN BONUS</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
    
                <div style="font-size: 1.0rem;border: 1px;border-style: solid;border-color: white;" class="px-4 my-3 mx-3 py-2">
                    IF AT LEAST ONE <img style="max-width: 40px;" src="treasurechest.png" alt=""> APPEARS ON EACH REEL, ADDITIONAL 13 FREE SPINS ARE AWARDED, TO A MAXIMUM OF 100 FREE SPINS IN A SINGLE BOUGHT GAME. RETRIGGER OF FREE SPIN BONUS WILL NOT CHANGE THE BONUS MULTIPLIER OF THE FREE SPIN BONUS. 
                    <br>
                    DURING FREE SPIN BONUS, THE WINS ARE MULTIPLIED BY THE BONUS MULTIPLIER AND ADDED TO THE WIN METER
                </div>
    
                <div style="border: 1px;border-color: #e4d594;font-size: 1.0rem;border-style: solid;" class="py-4 mx-3 d-flex justify-content-center align-items-around my-3">
                    <div class="px-2">
                        <span style="color: #e4d594;"> Denomination:</span> 0.01
                    </div>
                    <div class="px-2">
                        <span style="color: #e4d594;">Bet Multiplier:</span> 1
                    </div>
                </div>
    
    
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="scatter.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 250
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 40
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="explorer.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 200
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 30
                            </div>
                        </div>
                    </div>
                    <div class="col-12 my-3 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="compass.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 175
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 60
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 25
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="binoculars.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 150
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 50
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 20
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="a.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 100
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 20
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 10
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="k.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 90
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 15
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 8
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row my-4" style="font-size: 1.0rem;">
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="q.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 80
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 12
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 6
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2">
                        <img src="j.png" style="max-width: 100px;" alt="">
                        <div class="px-4">
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">5 - </span> 70
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">4 - </span> 10
                            </div>
                            <div class="my-1">
                                <span style="color: #e4d594;font-weight: bold;">3 - </span> 5
                            </div>
                        </div>
                    </div>
                    <div class="my-3 col-12 col-lg-4 col-dm-4 col-sm-12 d-flex justify-content-center align-items-center align-items-center mx-2" style="visibility: hidden;">
                        
                    </div>
                </div>
    
                <div style="font-size: 1.0rem;" class="text-center">
                    <div class="my-1">
                        ALL WINS PAY LEFTMOST TO RIGHT, EXCEPT <img src="treasurechest.png" style="max-width: 40px;" alt="">
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN FOR BET MULTIPLIER X1.
                    </div>
                    <div class="my-1">
                        PAYTABLE WINS ARE SHOWN IN CREDITS
                    </div>
                </div>
    
                <div class="divider-container mt-5">
                    <div class="divider-wrapper">
                        <div class="divider-text" style="font-weight: bold;">243 WAYS</div>
                    </div>
                </div>
    
                <div class="d-flex justify-content-center align-items-center">
                    <div style="width: 90%;background-color: white;height: 2px;"></div>
                </div>
    
                <div class="row px-3 my-3">
                    <div class="col-lg-3 col-md-12 col-sm-12 text-center px-4">
                        <img src="tick.png" style="max-width: 80%;" alt="">
                    </div>
                    <div class="col-lg-9 col-md-12 col-lg-12">
                        REELS = 5
                        <div class="d-flex justify-content-start align-items-center">
                            PLAY 5 REELS WITH MINIMUM BET 30 MULTIPLIED BY DENOMINATION.
                        </div>
                    </div>
                </div>
                <div>
                    <div style="width: 90%;margin-bottom: 140px;" class="mx-auto mt-3 pb-3">
                        <div>
                            ALL WINNING COMBINATIONS PAY FROM LEFT TO RIGHT ON ADJACENT REELS BEGINNING FROM LEFTMOST EXCEPT <img src="treasurechest.png" style="width: 40px;" alt="">
                        </div>
                        <div>
                            ALL WINS ARE MULTIPLIED BY THE BET MULTIPLIER. ONLY THE HIGHEST WINNING COMBINATION IS PAID ON EACH PAY WAY.
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="text-center py-3 w-100" style="position: fixed;bottom: 0;background-color: #191818;color: white;font-size: 1.0rem;z-index: 9999;margin: 0 !important;">
                <div>
                    MALFUNCTION VOIDS ALL PLAYS AND PAYS.
                </div>
                <div class="my-2 d-flex justify-content-center align-items-center">
                    <div class="d-flex justify-content-center align-items-center" style="height: 45px;width: 45px;border-radius: 50%;border-color: white;border-style: solid;">
                        <i id="close_info_button" class="fa fa-arrow-left fa-2x py-2 px-2"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="device_overlay" style="display: none;">
            <div class="d-flex flex-column justify-content-center align-items-center text-center p-4" 
                style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.99); color: white; font-size: 1.5rem; text-align: center; z-index: 9999; display: flex;"
                >
                <div class="container">
                    <h2 class="fw-bold">FOR AN OPTIMAL GAMING EXPERIENCE</h2>
                    <p class="lead">USE A MOBILE DEVICE</p>
                    <div class="my-3 text-center my-3">
                        <i class="fa fa-mobile-alt fa-3x"></i>
                    </div>
                </div>
            </div>
        </div>


        


        <div id="winOverlay" class="mobile-wrapper" >
            <button id="closeBtn" class="btn-close btn-close-white" aria-label="Close"></button>
            <div id="coinsContainer"></div>
            <div class="sunburst-container">
                <div id="sunburst"  class="sunburst mega-win-color"></div>
            </div>
            <div class="win-content">
                <h2 id="winText" class="win-text big-win">
                <img id="winImg" style="max-width: 200px;" src="winlevels/bigwin.png" alt="">
                </h2>
                <div class="counter-text" id="winAmount">$0</div>
            </div>
        </div>
        
        <div id="jdb_overlay">
            <div style="height: 100%;width: 100%;" class="d-flex justify-content-center align-items-center">
                <div class="row">
                    <div class="d-flex justify-content-center align-items-center mx-auto">
                        <div>
                            <img src="jdb_logo.png" style="max-width: 100%;" alt="mx-auto">
                            <div class="d-flex justify-content-center mx-auto">
                                <div class="loader-container" style="width: 50%;border-style: solid;border-width: 1px;">
                                    <div class="loader-bar" id="loader-bar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <div id="kong_overlay" >
            <div class="d-flex justify-content-center">
                <button class="glowing-button text-white" onclick="hideKongOverlay()">START</button>
            </div>
        </div>
    
        <div id="game-container" class="victor-mono">
            <div>
                <img id="img_top" src="bg-top6.gif" style="width: 100%;height: auto;" alt="">
                <img id="img_top_volcano_part_1" src="volcano.gif" style="width: 100%;height: auto;display: none;" alt="">
                <img id="img_top_volcano_part_2" src="volcano-part-2-complete.gif" style="width: 100%;height: auto;display: none;" alt="">
            </div>
            <div id="playground" style="background: url('nbcg1.png');min-height: 35vh;width: 100%;background-size: cover;">
                <div class="game-canvas-container">
                    <!-- Free Spins Indicator -->
                    <div id="free-spins-indicator" class="free-spins-indicator">
                        FREE SPINS: <span id="free-spins-count">0</span> | MULTIPLIER: <span id="bonus-multiplier">0</span>x
                    </div>
                    
                    <!-- Win Message -->
                    <div id="win-message" class="win-message">
                        <div>BIG WIN!</div>
                        <div id="win-amount">0.00</div>
                    </div>
                </div>
            </div>
    
            <!-- Controls -->
            <div class="game-controls p-2">
                <div id="results_holder" class="w-100 text-center text-white d-flex justify-content-center align-items-center" style="background-image: url('resultsbcg3.png');background-size: cover;height: 30px;font-size: 1.3rem;">
                    <div style="margin: 5px 0px;">
                        WIN <span class="px-1" id="update_winnings">0.00</span>
                    </div>
                </div>
                <div id="freespins_display" style="display: none; justify-content: center; align-items: center; padding-top: 2px;max-width: 100%;height: 100px;">
                    <img class="fs-text-image"  src="freespin_part_a.png" alt="">
                    <span class="px-3" id="remaining_fs_holder" >0</span>
                    <img class="fs-text-image" src="freespin_part_b.png"  alt="">
                    <span class="px-3" id="total_fs_holder">0</span>
                </div>
                <div id="normalspins_display" style="display: flex; justify-content: center; align-items: center; padding-top: 2px">
                    <div id="autoPlayButton" class="rounded-circle d-flex justify-content-center align-items-center autoplay-button" style="background-image: url('autospinbcg.png');background-size: cover;">
                        <img src="autospininnerimg.png" class="autospininner-img"  alt="">
                    </div>
                    <div id="spinButton" class="mx-4 d-flex justify-content-center align-items-center spin-button" style="border-radius: 50%;background-image: url('spinbcg.png');background-size: cover;">
                        <div id="remainingAutoSpins" style="z-index: 2;position: absolute;color: darkorange;font-weight:bolder;font-size: 1.5rem;">
                        </div>
                        <div class="d-flex justify-content-center align-items-center spin-img" id="spin_img" style="background: url('spininnerimg.png');background-size: cover;">
                            
                        </div>
                    </div>
                    
                    <!-- Stake button that opens the overlay -->
                    <div id="stakeButton" class="text-center d-flex justify-content-center align-items-center stake-button" style="background-image: url('totalbetbcg.png');background-size: cover;color: orange;font-size: 0.85rem;line-height: 1;font-weight: 900;border-radius: 50%;">
                        <div>
                            <div class="d-flex justify-content-center">
                                <img src="totalbetinnerimg.png" class="totalbetinner-img"  alt="">
                            </div>
                            <div class="text-center">
                                <span id="currentStake" class="current-stake">0.3</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container mb-2">
                    <div style="display: flex; width: 100%; position: relative; align-items: center;">
                        <div onclick="displaySettingsOverlay2()" id="settingsButton" style="border-radius: 50%;width: 50px; height: 50px;background-image: url('settings.png');background-size: cover;">
                        </div>

                        <script>
                            function displaySettingsOverlay2(){
                                alert('haaaaaaaaaaaaaaa')
                            }
                        </script>
                
                        <!-- Button at the center -->
                        <div style="position: absolute; left: 50%; transform: translateX(-50%); text-align: center;">
                            <span class="text-center">
                                <span class="badge px-4 py-2 text-white" style="background-color: rgba(0,0,0,0.7);">CREDIT: <span id="balanceText">1000.00</span></span>
                                <br>
                                <span class="text-white text-center" style="font-size: 1.0rem;">
                                    &lt; <span>DEMO GAME</span> &gt;
                                </span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- Stake Selection Overlay -->
        <div id="stakeOverlay" class="overlay" style="margin: 0 !important;padding: 0 !important;">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider"></div>
                    <div class="divider-text">TOTAL BET</div>
                    <div class="divider"></div>
                </div>
            </div>
            <div class="overlay-content-stake ">
                <div class="overlay-header">FUN</div>
                <div class="options-grid mx-auto" id="stakeOptions">
                    <button class="option-button selected" data-value="0.3">0.3</button>
                    <button class="option-button" data-value="0.6">0.6</button>
                    <button class="option-button" data-value="0.9">0.9</button>
                    <button class="option-button" data-value="1.5">1.5</button>
                    <button class="option-button" data-value="3.0">3.0</button>
                </div>
                <div class="text-center text-white mt-5 pt-5">
                    <span style="margin-left: 20px;">
                        Reels: 5
                    </span>
                </div>
                <div class="overlay-footer w-100">
                    <button style="display: none;" class="cancel-button px-4" id="cancelStake">Cancel</button>
                    <button class="confirm-button px-5" id="confirmStake">OK</button>
                </div>
            </div>
        </div>
    
        <!-- Auto Spin Overlay -->
        <div id="autoSpinOverlay" class="overlay">
            <div class="divider-container">
                <div class="divider-wrapper">
                    <div class="divider"></div>
                    <div class="divider-text">AUTOPLAYS</div>
                    <div class="divider"></div>
                </div>
            </div>
            <div class="overlay-content w-100" style="margin-top: 20px !important;">
                <div class="mb-2 text-white">
                    NUMBER OF SPINS
                </div>
                <div class="options-grid" id="autoSpinOptions">
                    <button class="option-button" data-value="0"><i class="fa fa-stop"></i></button>
                    <button class="option-button" data-value="999">999</button>
                    <button class="option-button" data-value="200">200</button>
                    <button class="option-button" data-value="100">100</button>
                    <button class="option-button" data-value="30">30</button>
                </div>
                <div class="mt-4 mb-2 text-white">
                    LOSS LIMIT
                </div>
                <div class="options-grid">
                    <button class="option-button"><i class="fa fa-infinity"></i></button>
                    <button class="option-button">500<span style="font-size: 0.7rem;">x BET</span></button>
                    <button class="option-button">100<span style="font-size: 0.7rem;">x BET</span></button>
                    <button class="option-button">50<span style="font-size: 0.7rem;">x BET</span></button>
                    <button class="option-button">10<span style="font-size: 0.7rem;">x BET</span></button>
                </div>
                <div class="divider-container my-3">
                    <div class="divider-wrapper">
                        <div style="height: 2px;background-color: #e4d594;width: 25vw;"></div>
                        <div class="divider-text" >QUICK SPIN</div>
                        <div style="height: 2px;background-color: #e4d594;width: 25vw;"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <img id="quickspin-toggle" src="quickspin-a.png" style="height: 60px;width: 60px;" alt="">
                    <script>
                        const img = document.getElementById("quickspin-toggle");

                        img.addEventListener("click", function () {
                            img.src = img.src.includes("quickspin-a.png") ? "quickspin-b.png" : "quickspin-a.png";
                        });

                        if (img.src.includes("quickspin-a.png")){
                            const div = document.getElementById("confirmAutoSpin");
                            div.style.backgroundColor = "#333";
                            div.style.boxShadow = "0 0 4px #e4d594";
                            div.style.color = "white";
                        }
                        else if (img.src.includes("quickspin-b.png")){
                            const div = document.getElementById("confirmAutoSpin");
                            div.style.backgroundColor = "#333";
                            div.style.color = "white";
                            div.style.boxShadow = "none";
                        }
                        
                       
                    </script>
                </div>
                <div class="overlay-footer">
                    <button class="cancel-button" id="cancelAutoSpin">Cancel</button>
                    <button class="confirm-button px-5" id="confirmAutoSpin">Ok</button>
                </div>
            </div>
        </div>
    
        <!-- Settings Overlay -->
        <div id="settingsOverlay" class="overlay" style="background-color: rgb(0,0,0,0.8);margin: 0 !important;padding: 0 !important;">
            <div class="divider-container">
                <!-- <div class="divider-wrapper">
                    <div class="divider"></div>
                    <div class="divider-text">SETTINGS</div>
                    <div class="divider"></div>
                </div> -->
            </div>
            <div onclick="hideSettingsOverlay()" class="overlay-content w-100" style="margin: 0 !important;padding: 0 !important;">
                <div>
                    

                    <div style="display: none;">
                        <div class="d-flex justify-content-center">
                            <div id="soundEffectsOption" class="sound-option selected mx-auto">
                                <div>
                                    <span id="soundEffectsIcon" class="icon-container"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>
            <div class="overlay-footer" style="background-image: url('bcg-settings.png');background-size: cover;margin: 0 !important;padding: 0 !important;">
                <div class="w-100 mb-2">
                    <div class="d-flex justify-content-around align-items-center py-5 px-3 w-100">
                        <div id="info_button" class="sound-option selected">
                            <div class="d-flex justify-content-center align-items-center" style="color:#e4d594;width: 30px;height: 30px;border-radius: 50%;border-color: #e4d594;border-style: solid;">
                                <i class="fas fa-question" style="font-size: 1.2rem;font-weight: bold;" ></i>
                            </div>
                        </div>
                        <div id="backgroundMusicOption" class="sound-option selected">
                            <div>
                                <span id="backgroundMusicIcon" class="icon-container">
                                    <i class="fa fa-volume-up" style="color: #e4d594;font-size: 1.4rem;"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <i class="fa fa-user px-1"></i> <span style="font-size: 0.7rem;">demo004817</span>
                    </div>
                </div>
                <div class="d-none">
                    <button class="cancel-button px-4" id="cancelSettings">Cancel</button>
                    <button class="confirm-button px-5" id="confirmSettings">OK</button>
                </div>
            </div>
        </div>
    
    
    </div>
</div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/@fand/gifuct-js@1.0.0/src/index.min.js"></script>

    <script src="https://unpkg.com/omggif/omggif.js"></script>
    <script>
        coinImages = [
            "coins/0_BigWin_SS.png", "coins/1_BigWin_SS.png", "coins/2_BigWin_SS.png", "coins/3_BigWin_SS.png",
            "coins/4_BigWin_SS.png", "coins/5_BigWin_SS.png", "coins/6_BigWin_SS.png", "coins/7_BigWin_SS.png",
            "coins/8_BigWin_SS.png", "coins/9_BigWin_SS.png", "coins/10_BigWin_SS.png", "coins/11_BigWin_SS.png",
            "coins/12_BigWin_SS.png", "coins/13_BigWin_SS.png", "coins/14_BigWin_SS.png", "coins/15_BigWin_SS.png",
            "coins/16_BigWin_SS.png", "coins/17_BigWin_SS.png", "coins/18_BigWin_SS.png", "coins/19_BigWin_SS.png",
            "coins/20_BigWin_SS.png", "coins/21_BigWin_SS.png", "coins/22_BigWin_SS.png", "coins/23_BigWin_SS.png",
            "coins/24_BigWin_SS.png", "coins/25_BigWin_SS.png", "coins/26_BigWin_SS.png", "coins/27_BigWin_SS.png",
            "coins/28_BigWin_SS.png", "coins/29_BigWin_SS.png", "coins/30_BigWin_SS.png"
        ];
      

      // Preload images for smoother animation
      coinImages.forEach(src => {
        const img = new Image();
        img.src = src;
        img.crossOrigin = "anonymous";
      });

      // Win level configurations
      const winLevels = {
        big: {
          imgSrc: 'winlevels/bigwin.png',
          text: 'BIG WIN',
          textClass: 'big-win',
          sunburstClass: 'big-win-color',
          threshold: 100,
          coinCount: 60
        },
        mega: {
          imgSrc: 'winlevels/megawin.png',
          text: 'MEGA WIN',
          textClass: 'mega-win',
          sunburstClass: 'mega-win-color',
          threshold: 300,
          coinCount: 100
        },
        ultra: {
          imgSrc: 'winlevels/ultrawin.png',
          text: 'ULTRA WIN',
          textClass: 'ultra-win',
          sunburstClass: 'ultra-win-color',
          threshold: Infinity,
          coinCount: 160
        }
      };

      // Function to determine win level based on amount
      function getWinLevel(amount) {
        if (amount < winLevels.big.threshold) {
          return 'big';
        } else if (amount < winLevels.mega.threshold) {
          return 'mega';
        } else {
          return 'ultra';
        }
      }

      // Function to show the win animation
      function showWinAnimation(amount) {
        // do not show big win animation during free spins
        if (autoSpins > 0 || isFreeSpinMode){
            return
        }
        // Reset any existing animations
        clearTimeout(window.autoCloseTimeout);
        
        // Set initial win level
        let currentLevel = 'big';
        document.getElementById('winImg').src = "winlevels/bigwin.png";
        updateWinLevel(currentLevel);
        
        // Show the overlay
        const winOverlay = document.getElementById('winOverlay');
        winOverlay.style.display = 'flex';
        
        // Start with $0
        let currentAmount = 0;
        const winAmount = document.getElementById('winAmount');
        winAmount.textContent = '$' + currentAmount.toLocaleString();
        
        // Create the coin fountain
        setTimeout(() => {
          createCoinFountain(winLevels[currentLevel].coinCount);
        }, 100);
        
        // Animate the counter
        const duration = 7000; // 5 seconds for the counter
        const fps = 60;
        const increment = amount / (duration / 1000 * fps);
        const startTime = performance.now();
        
        function updateCounter(timestamp) {
          const elapsed = timestamp - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          currentAmount = progress * amount;
          winAmount.textContent = '$' + Math.floor(currentAmount).toLocaleString();
          
          // Check if we need to upgrade the win level
          const newLevel = getWinLevel(currentAmount);
          if (newLevel !== currentLevel) {
            currentLevel = newLevel;
            updateWinLevel(currentLevel);
            
            // Add more coins for the new level
            createCoinFountain(winLevels[currentLevel].coinCount);
          }
          
          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          } else {
            // Counter finished
            winAmount.textContent = '$' + amount.toLocaleString();
            
            // Auto close after 3 seconds
            window.autoCloseTimeout = setTimeout(() => {
              closeWinAnimation();
            }, 2000);
          }
        }
        
        requestAnimationFrame(updateCounter);
      }
      
      // Function to update the win level visuals
      function updateWinLevel(level) {
        const winText = document.getElementById('winText');
        const winImg = document.getElementById('winImg');
        const sunburst = document.getElementById('sunburst');
        
        // Remove all classes
        winText.classList.remove('big-win', 'mega-win', 'ultra-win');
        sunburst.classList.remove('big-win-color', 'mega-win-color', 'ultra-win-color');
        
        // Add new classes
        winText.classList.add(winLevels[level].textClass);
        sunburst.classList.add(winLevels[level].sunburstClass);
        
        winImg.style.transform = 'scale(0.8)';
        setTimeout(() => {
          winImg.src = winLevels[level].imgSrc;
          winImg.style.transform = 'scale(1.2)';
          setTimeout(() => {
            winImg.style.transform = 'scale(1)';
          }, 150);
        }, 150);
      }

      // Function to close the win animation
      function closeWinAnimation() {
        removeBonusFrame()
        const winOverlay = document.getElementById('winOverlay');
        winOverlay.style.display = 'none';
        clearTimeout(window.autoCloseTimeout);
        
        // Clear all coins
        const coinsContainer = document.getElementById('coinsContainer');
        coinsContainer.innerHTML = '';
      }

      // Function to create the coin fountain with 3D rotating coins
      function createCoinFountain(numberOfCoins) {
        const coinsContainer = document.getElementById('coinsContainer');
        
        // Create fountain of coins
        const containerWidth = coinsContainer.offsetWidth;
        const containerHeight = coinsContainer.offsetHeight;
        
        // Center bottom position
        const centerX = containerWidth / 2;
        
        // Adjust coin count based on screen size
        const isMobile = window.innerWidth < 576;
        const actualCoinCount = isMobile ? Math.floor(numberOfCoins * 0.6) : numberOfCoins;
        
        for (let i = 0; i < actualCoinCount; i++) {
          setTimeout(() => {
            // Create coin container element
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            // Random size between 10-30px on mobile, 20-40px on desktop
            const minSize = isMobile ? 15 : 25;
            const maxSizeRange = isMobile ? 25 : 25;
            const coinSize = Math.floor(Math.random() * maxSizeRange) + minSize;
            coin.style.width = `${coinSize}px`;
            coin.style.height = `${coinSize}px`;
            
            // Create the img element inside the coin div
            const coinImg = document.createElement('img');
            coinImg.src = coinImages[0]; // Start with the first image
            coinImg.style.width = '100%';
            coinImg.style.height = '100%';
            coinImg.crossOrigin = "anonymous"; // Avoid CORS issues
            coin.appendChild(coinImg);
            
            // Start at center bottom with slight random offset
            const startX = centerX + (Math.random() - 0.5) * 50;
            coin.style.left = `${startX}px`;
            coin.style.bottom = '0px';
            
            // Add to container
            coinsContainer.appendChild(coin);
            
            // Animate the coin in a fountain pattern with 3D rotation
            animateCoinFountain(coin, coinImg, startX, containerHeight);
          }, i * 70); // Stagger the coin creation
        }
      }

      // Function to animate a single coin in a fountain pattern with 3D rotation
      function animateCoinFountain(coin, coinImg, startX, containerHeight) {
        const coinsContainer = document.getElementById('coinsContainer');
        const containerWidth = coinsContainer.offsetWidth;
        
        // Adjust physics based on screen size
        const isMobile = window.innerWidth < 576;
        const velocityMultiplier = isMobile ? 0.8 : 1;
        
        // Random angle for the fountain spread (narrower at the bottom, wider at the top)
        const angle = ((Math.random() - 0.5) * Math.PI) / 2; // -45 to +45 degrees
        
        // Random initial velocity (speed)
        const initialVelocity = (15 + Math.random() * 10) * velocityMultiplier;
        
        // Calculate velocity components
        const vx = initialVelocity * Math.sin(angle);
        const vy = initialVelocity * Math.cos(angle);
        
        // Animation parameters
        const gravity = 0.5 * velocityMultiplier;
        const duration = 2000 + Math.random() * 1000;
        const fps = 60;
        const totalFrames = (duration / 1000) * fps;
        
        // Animation variables
        let currentFrame = 0;
        let x = startX;
        let y = 0;
        let velocityY = vy;
        
        // 3D rotation variables
        let currentImageIndex = 0;
        const rotationSpeed = (0.1 + Math.random() * 0.2) * velocityMultiplier; // Random rotation speed
        
        // Animation function
        const animate = () => {
          if (!coin.parentNode) return; // Stop if coin was removed
          
          // Update position with gravity
          x += vx;
          velocityY -= gravity;
          y += velocityY;
          
          // Update coin position
          coin.style.left = `${x}px`;
          coin.style.bottom = `${y}px`;
          
          // Update 3D rotation - change the image based on the current frame
          currentImageIndex = (currentImageIndex + rotationSpeed) % coinImages.length;
          coinImg.src = coinImages[Math.floor(currentImageIndex)];
          
          // Add perspective tilt based on movement direction
          const tiltX = vx * 2; // Tilt based on horizontal velocity
          const tiltY = velocityY; // Tilt based on vertical velocity
          coin.style.transform = `perspective(500px) rotateX(${tiltY}deg) rotateY(${tiltX}deg)`;
          
          // Adjust shadow based on height
          const shadowBlur = Math.min(5 + y/20, 15);
          coin.style.filter = `drop-shadow(0 0 ${shadowBlur}px rgba(255, 215, 0, 0.7))`;
          
          // Check if coin is still visible
          if (y < -100 || x < -100 || x > containerWidth + 100) {
            if (coin.parentNode) {
              coin.parentNode.removeChild(coin);
            }
            return;
          }
          
          // Continue animation
          currentFrame++;
          if (currentFrame < totalFrames) {
            requestAnimationFrame(animate);
          } else {
            // Remove coin after animation completes
            if (coin.parentNode) {
              coin.parentNode.removeChild(coin);
            }
          }
        };
        
        // Start animation
        requestAnimationFrame(animate);
      }

      // Handle window resize
      window.addEventListener('resize', function() {
        // Adjust sunburst size if needed
        const sunburstContainer = document.querySelector('.sunburst-container');
        if (sunburstContainer) {
          const size = Math.min(window.innerWidth * 0.8, 400);
          sunburstContainer.style.width = `${size}px`;
          sunburstContainer.style.height = `${size}px`;
        }
      });

      document.getElementById('closeBtn').addEventListener('click', () => {
        closeWinAnimation();
      });
      
      document.getElementById('winOverlay').addEventListener('click', (e) => {
        if (e.target === document.getElementById('winOverlay')) {
          closeWinAnimation();
        }
      });

      // Make the function available globally
      window.showWinAnimation = showWinAnimation;
      window.closeWinAnimation = closeWinAnimation;


        ///separator

        async function fetchGifAsBuffer(url) {
        const response = await fetch(url);
        const arrayBuffer = await response.arrayBuffer();
        return arrayBuffer;
        }

        async function getGifDuration(url) {
        const arrayBuffer = await fetchGifAsBuffer(url);
        const gif = gifuct.parseGIF(arrayBuffer);
        const frames = gifuct.decompressFrames(gif, true);
        
        const duration = frames.reduce((total, frame) => {
            const delay = frame.delay || 10; // in hundredths of a second
            return total + delay * 10; // convert to milliseconds
        }, 0);

        return duration;
        }

        async function onGifFinish(url, callback) {
        const duration = await getGifDuration(url);
        console.log(`GIF duration: ${duration}ms`);
        setTimeout(callback, duration);
        }

        // Use the function
        const gifElement = document.getElementById("myGif");
        const gifUrl = gifElement.src;

        onGifFinish(gifUrl, () => {
        console.log("GIF finished playing once.");
        // You can trigger any logic here, like hiding the GIF or showing a message
        });
  </script>


    <script>
        if (window.innerWidth >= 900) {
            document.getElementById("device_overlay").style.display = "none";
        }

        document.addEventListener("DOMContentLoaded", function () {
            let loaderBar = document.getElementById("loader-bar");
            let progress = 0;
            
            function updateProgress() {
                progress += Math.random() * 10;
                if (progress < 100) {
                    loaderBar.style.width = progress + "%";
                    setTimeout(updateProgress, 200);
                } else {
                    loaderBar.style.width = "100%";
                    setTimeout(() => document.querySelector(".loader-container").style.display = "none", 500);
                    document.getElementById('jdb_overlay').style.display = "none";
                }
            }
            
            updateProgress();
        });

        // Background music
        const backgroundMusic = new Audio();
        backgroundMusic.src = 'gameaudio.mp3';
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.5;
        backgroundMusic.preload = 'auto';

        // const backgroundMusic = new Audio();
        // backgroundMusic.src = "gameaudio.mp3";
        // backgroundMusic.loop = true;
        // backgroundMusic.volume = 0.5;

        function hideKongOverlay(){
            document.getElementById('kong_overlay').style.display = "none";
            // Try to play background music (will be blocked by browsers until user interaction)
            backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
        }

        // Mobile-optimized game configuration
        const gameContainer = document.querySelector('.game-canvas-container');
        const app = new PIXI.Application({
            width: gameContainer.clientWidth,
            height: gameContainer.clientHeight,
            autoDensity: true,
            resolution: window.devicePixelRatio || 1,
            transparent: true
        });
        gameContainer.appendChild(app.view);

        // Load the background image
        const backgroundTexture = PIXI.Texture.from('nbcg2.png');
        const backgroundSprite = new PIXI.Sprite(backgroundTexture);


        // Function to resize the background
        function resizeBackground() {
            backgroundSprite.width = app.screen.width;
            backgroundSprite.height = app.screen.height;
        }

        // Ensure the background resizes properly
        resizeBackground();
        app.stage.addChild(backgroundSprite);


        // Change the background image
        function changeBackground(newImagePath) {
            const newTexture = PIXI.Texture.from(newImagePath);
            backgroundSprite.texture = newTexture;
        }


        // Handle window resizing
        window.addEventListener('resize', () => {
            app.renderer.resize(gameContainer.clientWidth, gameContainer.clientHeight);
            resizeBackground();
        });

        // Kong game constants
        const KONG_SYMBOLS = {
        "Treasure Chest": {
            name: "Treasure Chest",
            image: 'treasurechest.png',
            payouts: [0, 0, 40, 100, 250]
        },
        "Explorer": {
            name: "Explorer",
            image: 'explorer.png',
            payouts: [0, 0, 30, 80, 200]
        },
        "Compass": {
            name: "Compass",
            image: 'compass.png',
            payouts: [0, 0, 25, 60, 175]
        },
        "Binoculars": {
            name: "Binoculars",
            image: 'binoculars.png',
            payouts: [0, 0, 20, 50, 150]
        },
        "A": {
            name: "A",
            image: 'a.png',
            payouts: [0, 0, 10, 20, 100]
        },
        "K": {
            name: "K",
            image: 'k.png',
            payouts: [0, 0, 8, 15, 90]
        },
        "Q": {
            name: "Q",
            image: 'q.png',
            payouts: [0, 0, 6, 12, 80]
        },
        "J": {
            name: "J",
            image: 'j.png',
            payouts: [0, 0, 5, 10, 70]
        },
        "Wild": {
            name: "Wild",
            image: 'wild.png',
            payouts: [0, 0, 50, 125, 300]  },
        "Scatter": {
            name: "Scatter",
            image: 'scatter.png',
            payouts: [0, 0, 5, 20, 50]
        }
    };

        // Bet levels as defined in the documentation
        const BET_LEVELS = [0.3, 0.6, 0.9, 1.5, 3.0];

        // Multiplier mapping for bet amounts
        const BET_MULTIPLIERS = {
            0.3: 1,
            0.6: 2,
            0.9: 3,
            1.5: 5,
            3.0: 10
        };

        // Game variables
        const symbols = [
        { name: 'Treasure Chest', image: 'treasurechest.png', multiplier: 2 },
        { name: 'Explorer', image: 'explorer.png', multiplier: 5 },
        { name: 'Compass', image: 'compass.png', multiplier: 5 },
        { name: 'Binoculars', image: 'binoculars.png', multiplier: 5 },
        { name: 'A', image: 'a.png', multiplier: 5 },
        { name: 'K', image: 'k.png', multiplier: 5 },
        { name: 'Q', image: 'q.png', multiplier: 5 },
        { name: 'J', image: 'j.png', multiplier: 5 },
        { name: 'Wild', image: 'wild.png', multiplier: 10 },
        { name: 'Scatter', image: 'scatter.png', multiplier: 3 }
    ];
        const symbolMultiplierMap = new Map(symbols.map(s => [s.name, s.multiplier]));

        // Preload reel background image
        // const reelBackgroundTexture = PIXI.Texture.from('reel-bg.jpg');

        const reels = [];
        const reelSymbols = []; // Array to track symbols separately from reel containers
        const numReels = 5;
        const numRows = 3;
        let spinning = false;
        let balance = 1000;
        let stake = 0.3;
        let autoSpins = 0;
        let currentInterval;
        let selectedStake = 0.3; // Default stake value
        let selectedAutoSpins = 0; // Default auto spins value

        // Free spins state
        let isFreeSpinMode = false;
        let freeSpinCount = 0;
        let bonusMultiplier = 0;
        let originalBetAmount = 0;

        // Sound control variables
        let soundEffectsEnabled = true;
        let backgroundMusicEnabled = true;
        let tempSoundEffectsEnabled = true;
        let tempBackgroundMusicEnabled = true;

        // Display elements
        const remainingAutoSpins = document.getElementById('remainingAutoSpins')
        const spinButtonInnerImage = document.getElementById('spin_img')
        const balanceText = document.getElementById('balanceText');
        const currentStakeElement = document.getElementById('currentStake');
        const spinButton = document.getElementById('spinButton');
        const autoPlayButton = document.getElementById('autoPlayButton');
        const stakeButton = document.getElementById('stakeButton');
        const stakeOverlay = document.getElementById('stakeOverlay');
        const infoOverlay = document.getElementById('gameinfo_overlay');
        const closeInfoButton = document.getElementById('close_info_button');
        const infoButton = document.getElementById('info_button')
        const autoSpinOverlay = document.getElementById('autoSpinOverlay');
        const stakeOptions = document.getElementById('stakeOptions');
        const autoSpinOptions = document.getElementById('autoSpinOptions');
        const cancelStakeButton = document.getElementById('cancelStake');
        const confirmStakeButton = document.getElementById('confirmStake');
        const cancelAutoSpinButton = document.getElementById('cancelAutoSpin');
        const confirmAutoSpinButton = document.getElementById('confirmAutoSpin');
        const winMessageElement = document.getElementById('win-message');
        const winAmountElement = document.getElementById('win-amount');
        const freeSpinsIndicator = document.getElementById('free-spins-indicator');
        const freeSpinsCountElement = document.getElementById('free-spins-count');
        const bonusMultiplierElement = document.getElementById('bonus-multiplier');

        // Settings elements
        const settingsButton = document.getElementById('settingsButton');
        const settingsOverlay = document.getElementById('settingsOverlay');
        const soundEffectsOption = document.getElementById('soundEffectsOption');
        const backgroundMusicOption = document.getElementById('backgroundMusicOption');
        const soundEffectsIcon = document.getElementById('soundEffectsIcon');
        const backgroundMusicIcon = document.getElementById('backgroundMusicIcon');
        const cancelSettingsButton = document.getElementById('cancelSettings');
        const confirmSettingsButton = document.getElementById('confirmSettings');

        // Sound effects
        const spinSound = new Audio();
        spinSound.src = 'spin.mp3';
        spinSound.preload = 'auto';
        
        const winSound = new Audio();
        winSound.src = 'win.mp3';
        winSound.preload = 'auto';

        


        function rotateSpinButtonImage(){
            spinButtonInnerImage.style.transform = 'rotate(180deg)';
        }

        // Calculate reel dimensions based on available space
        function calculateReelDimensions() {
            const availableWidth = app.screen.width;
            const availableHeight = app.screen.height;
            
            const reelWidth = availableWidth / numReels * 0.99;
            const reelHeight = availableHeight * 0.99;
            
            return { reelWidth, reelHeight };
        }

        // Create reels
        function createReels() {
            // Clear existing reels
            reels.forEach(reel => {
                app.stage.removeChild(reel);
            });
            reels.length = 0;
            reelSymbols.length = 0;
            
            const { reelWidth, reelHeight } = calculateReelDimensions();

            

            // Load animated GIF as frames (you must have frame0.png, frame1.png, ..., frameN.png)

            const frameTextures = [];
            const totalFrames = 12; //  Update this to match how many frames your GIF has

            for (let f = 0; f < totalFrames; f++) {
                frameTextures.push(PIXI.Texture.from(`green/${f}_Base_Reel_SpeedUp_SS.png`));
            }

            for (let i = 0; i < numReels; i++) {
                const reel = new PIXI.Container();
                reel.x = (app.screen.width / numReels) * i + (app.screen.width / numReels - reelWidth) / 2;
                reel.y = (app.screen.height - reelHeight) / 2;

                const symbolContainer = new PIXI.Container();
                reel.addChild(symbolContainer);

                reels.push(reel);
                reelSymbols.push(symbolContainer);
                app.stage.addChild(reel);
            
            }

            // Populate reels
            populateReels();
        }

        // Populate all reels with symbols
        function populateReels() {
            for (let i = 0; i < numReels; i++) {
                populateReel(i);
            }
        }

        // Populate a single reel with symbols
        function populateReel(reelIndex) {
            const symbolContainer = reelSymbols[reelIndex];
            symbolContainer.removeChildren();
            
            const { reelWidth, reelHeight } = calculateReelDimensions();
            
            const rowSymbols = [];
            for (let j = 0; j < numRows; j++) {
                const symbol = symbols[Math.floor(Math.random() * symbols.length)];
                const texture = PIXI.Texture.from(symbol.image);
                const sprite = new PIXI.Sprite(texture);
                sprite.y = j * (reelHeight / numRows);
                sprite.x = reelWidth * 0.03; // Add a small margin
                sprite.width = reelWidth * 0.99;
                sprite.height = (reelHeight / numRows) * 1;
                sprite.symbolName = symbol.name;
                symbolContainer.addChild(sprite);
                rowSymbols.push(sprite);
            }
            
            return rowSymbols;
        }

        // Function to display final symbols for a specific reel
        function displayFinalSymbolsForReel(reelIndex, reelSymbolNames) {
            const { reelWidth, reelHeight } = calculateReelDimensions();
            const symbolContainer = reelSymbols[reelIndex];
            symbolContainer.removeChildren();
            
            // Loop through each row in the reel
            for (let j = 0; j < numRows; j++) {
                const symbolName = reelSymbolNames[j];
                const symbolData = KONG_SYMBOLS[symbolName];
                
                if (symbolData) {
                    const texture = PIXI.Texture.from(symbolData.image);
                    const sprite = new PIXI.Sprite(texture);
                    sprite.y = j * (reelHeight / numRows);
                    sprite.x = reelWidth * 0.01; // Add a small margin
                    sprite.width = reelWidth * 0.96;
                    sprite.height = (reelHeight / numRows) * 1;
                    sprite.symbolName = symbolName;
                    sprite.reelIndex = reelIndex;
                    sprite.rowIndex = j;
                    symbolContainer.addChild(sprite);
                }
            }
        }

        // Add this new function to display the API symbols
        function displayAPISymbols(apiReels) {
            // Loop through each reel
            for (let i = 0; i < numReels; i++) {
                displayFinalSymbolsForReel(i, apiReels[i]);
            }
        }

// Replace the spinAnimation function with this improved version that creates a more natural flowing effect:

function spinAnimation(callback, apiResult) {
    if (currentInterval) clearInterval(currentInterval);
    
    const spinCounts = [25, 30, 35, 40, 50]; // Different stop times for each reel
    const remainingSpins = [...spinCounts];
    
    // Create arrays to hold the flowing symbols for each reel
    const flowingSymbols = [];
    
    // Number of extra symbols to create the flowing effect (more symbols = smoother flow)
    const extraSymbols = 15;
    
    // Initialize flowing symbols for each reel
    for (let i = 0; i < numReels; i++) {
        flowingSymbols[i] = [];
        // Initialize with random symbols (more than we need to create the flowing effect)
        for (let j = 0; j < numRows + extraSymbols; j++) {
            const symbol = symbols[Math.floor(Math.random() * symbols.length)];
            flowingSymbols[i].push(symbol);
        }
    }
    
    // Track position offset for smooth animation
    const positionOffsets = Array(numReels).fill(0);
    
    // Animation speed (lower = slower)
    const animationSpeed = 0.2;
    
    currentInterval = setInterval(() => {
        let allStopped = true;
        
        for (let i = 0; i < numReels; i++) {
            if (remainingSpins[i] > 0) {
                // Continue flowing symbols until ready to stop
                const symbolContainer = reelSymbols[i];
                symbolContainer.removeChildren();
                
                const { reelWidth, reelHeight } = calculateReelDimensions();
                const symbolHeight = reelHeight / numRows;
                
                // Update position offset for this reel
                positionOffsets[i] += animationSpeed;
                
                // When offset exceeds 1, shift symbols and reset offset
                if (positionOffsets[i] >= 1) {
                    // Shift symbols down by removing the first one and adding a new one at the end
                    flowingSymbols[i].shift();
                    const newSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                    flowingSymbols[i].push(newSymbol);
                    positionOffsets[i] = 0;
                }
                
                // Display the current visible symbols with smooth position adjustment
                // We display more symbols to ensure a continuous flow
                for (let j = 0; j < numRows + 2; j++) {
                    if (j < flowingSymbols[i].length) {
                        const symbol = flowingSymbols[i][j];
                        const texture = PIXI.Texture.from(symbol.image);
                        const sprite = new PIXI.Sprite(texture);
                        
                        // Position with offset to create flowing effect
                        // This creates a smooth continuous flow
                        sprite.y = (j - 1 - positionOffsets[i]) * symbolHeight;
                        sprite.x = reelWidth * 0.03;
                        sprite.width = reelWidth * 0.99;
                        sprite.height = symbolHeight;
                        sprite.symbolName = symbol.name;
                        
                        symbolContainer.addChild(sprite);
                    }
                }
                
                // Decrement remaining spins
                if (i === 0 || remainingSpins[i-1] <= spinCounts[i-1] - 5) {
                    // Only start decrementing after the previous reel has started to slow down
                    remainingSpins[i]--;
                }
                allStopped = false;
            } else if (remainingSpins[i] === 0) {
                // When a reel is ready to stop, prepare for the final symbols
                // We'll gradually slow down and align to the final position
                const symbolContainer = reelSymbols[i];
                
                // If we have API results, prepare the final symbols
                if (apiResult && apiResult.reels && apiResult.reels[i]) {
                    const finalSymbols = apiResult.reels[i];
                    
                    // Replace the last symbols in the flowing array with the final ones
                    for (let j = 0; j < numRows; j++) {
                        const symbolIndex = flowingSymbols[i].length - numRows + j;
                        if (symbolIndex >= 0) {
                            const finalSymbolName = finalSymbols[j];
                            const finalSymbolData = KONG_SYMBOLS[finalSymbolName];
                            if (finalSymbolData) {
                                flowingSymbols[i][symbolIndex] = {
                                    name: finalSymbolName,
                                    image: finalSymbolData.image,
                                    multiplier: symbolMultiplierMap.get(finalSymbolName) || 1
                                };
                            }
                        }
                    }
                    
                    // Slow down the animation for a smooth stop
                    positionOffsets[i] += 0.05;
                    
                    // When we reach the correct position, stop the reel
                    if (positionOffsets[i] >= 0.95) {
                        displayFinalSymbolsForReel(i, finalSymbols);
                        remainingSpins[i] = -1; // Mark as completely stopped
                    } else {
                        // Continue the flowing animation but slower
                        const { reelWidth, reelHeight } = calculateReelDimensions();
                        const symbolHeight = reelHeight / numRows;
                        
                        symbolContainer.removeChildren();
                        
                        // Display the current visible symbols with smooth position adjustment
                        for (let j = 0; j < numRows + 2; j++) {
                            if (j < flowingSymbols[i].length) {
                                const symbol = flowingSymbols[i][j];
                                const texture = PIXI.Texture.from(symbol.image);
                                const sprite = new PIXI.Sprite(texture);
                                
                                // Position with offset to create flowing effect
                                sprite.y = (j - 1 - positionOffsets[i]) * symbolHeight;
                                sprite.x = reelWidth * 0.03;
                                sprite.width = reelWidth * 0.99;
                                sprite.height = symbolHeight;
                                sprite.symbolName = symbol.name;
                                
                                symbolContainer.addChild(sprite);
                            }
                        }
                        
                        allStopped = false;
                    }
                } else {
                    // If no API results, just display random final symbols
                    displayFinalSymbolsForReel(i, flowingSymbols[i].slice(-numRows).map(s => s.name));
                    remainingSpins[i] = -1; // Mark as completely stopped
                }
            }
        }
        
        if (allStopped) {
            clearInterval(currentInterval);
            spinning = false;
            currentInterval = null;
            
            // Ensure the final display matches exactly what the API returned
            if (apiResult && apiResult.reels) {
                displayAPISymbols(apiResult.reels);
                
                // Highlight winning symbols if there's a win
                if (apiResult.win_amount > 0) {
                    highlightWinningSymbols(apiResult.reels, apiResult.winning_positions);
                }
            }
            
            callback();
        }
    }, 50); // Faster interval for smoother animation
}

        // Function to highlight winning symbols
        // function highlightWinningSymbols(apiReels, winningPositions) {
        //     // If no winning positions are passed, initialize it as an empty array
        //     winningPositions = winningPositions || [];

        //     console.log('------------Listing winning positions----------------');
        //     console.log(winningPositions);

        //     // Define a mapping of symbol names to z-index values
        //     const symbolZIndexMap = {
        //         "Treasure Chest": 80,
        //         "Wild": 100,
        //         "Scatter": 90,
        //         "Explorer": 60,
        //         "Compass": 60,
        //         "Binoculars": 70,
        //         "A": 50,
        //         "K": 50,
        //         "Q": 50,
        //         "J": 50
        //         // Add other symbols and their respective z-indexes here
        //     };

        //     // Loop through each reel
        //     for (let i = 0; i < numReels; i++) {
        //         const symbolContainer = reelSymbols[i]; // Container for current reel symbols

        //         // Loop through each symbol (child sprite) in this reel
        //         for (let j = 0; j < symbolContainer.children.length; j++) {
        //             const sprite = symbolContainer.children[j];             // Visual representation (sprite)
        //             const currentSymbolName = apiReels[i][j];               // Symbol name from API

        //             // Check if this symbol is in the list of winning positions
        //             const isWinning = winningPositions.some(pos =>
        //                 pos.symbol === currentSymbolName && pos.reel === i && pos.row === j
        //             );

        //             console.log('------------nice--------------------');
        //             console.log(isWinning);

        //             if (isWinning) {
        //                 // Reset visual styles
        //                 sprite.filters = [];
        //                 sprite.visible = true;
        //                 sprite.alpha = 1;
        //                 sprite.tint = 0xFFFFFF;
        //                 sprite.rotation = 0;

        //                 // Assign zIndex based on the symbol name from the mapping
        //                 sprite.zIndex = symbolZIndexMap[currentSymbolName] || 0;  // Default to 0 if not found in map

        //                 // Store original values for later reset
        //                 const originalX = sprite.x;
        //                 const originalY = sprite.y;
        //                 const originalScale = { x: sprite.scale.x, y: sprite.scale.y };
        //                 const originalTexture = sprite.texture;

        //                 // Define the maximum scale increase (20%)
        //                 const maxScaleX = originalScale.x * 1.0;
        //                 const maxScaleY = originalScale.y * 1.0;

        //                 let animationTicker;

        //                 switch (currentSymbolName) {
        //                     case "Treasure Chest":
        //                         animationTicker = () => {
        //                             sprite.visible = Math.floor(Date.now() / 100) % 2 === 0;
        //                             sprite.scale.set(maxScaleX, maxScaleY);
        //                         };
        //                         break;


        //                     case "Wild":
        //                         const blinkTexture = PIXI.Texture.from("wild3.gif");
        //                         animationTicker = () => {
        //                             sprite.texture = Math.floor(Date.now() / 850) % 2 === 0
        //                                 ? blinkTexture
        //                                 : originalTexture;
        //                             sprite.scale.set(originalScale.x, originalScale.y);
        //                         };
        //                         break;

        //                     case "Scatter":
        //                         animationTicker = () => {
        //                             sprite.alpha = 0.5 
        //                             + 0.5 * Math.sin(Date.now() / 200);
        //                             sprite.scale.set(maxScaleX, maxScaleY);
        //                         };
        //                         break;

        //                     case "Explorer":
        //                         animationTicker = () => {
        //                             sprite.visible = Math.floor(Date.now() / 450) % 2 === 0;
        //                             sprite.scale.set(maxScaleX, maxScaleY);
        //                         };
        //                         break;

        //                     case "Compass":
        //                     case "Binoculars":
        //                         animationTicker = () => {
        //                             sprite.x = originalX + Math.sin(Date.now() / 80) * 4;
        //                             sprite.scale.set(maxScaleX, maxScaleY);
        //                         };
        //                         break;

        //                     case "A":
        //                     case "K":
        //                     case "Q":
        //                     case "J":
        //                         animationTicker = () => {
        //                             sprite.visible = Math.floor(Date.now() / 450) % 2 === 0;
        //                             sprite.scale.set(maxScaleX, maxScaleY);
        //                         };
        //                         break;

        //                     default:
        //                         const blinkTexture2 = PIXI.Texture.from("explorer_blink.gif");
        //                         animationTicker = () => {
        //                             sprite.texture = Math.floor(Date.now() / 300) % 2 === 0
        //                                 ? blinkTexture2
        //                                 : originalTexture;
        //                             sprite.scale.set(originalScale.x, originalScale.y);
        //                         };
                                
                                
        //                 }

        //                 // Start the animation
        //                 const tickerRef = app.ticker.add(animationTicker);
        //                 sprite._tickerRef = tickerRef;

        //                 // Stop animation after 3 seconds and reset everything
        //                 setTimeout(() => {
        //                     if (app.ticker && sprite._tickerRef) {
        //                         app.ticker.remove(sprite._tickerRef);
        //                     }

        //                     sprite.visible = true;
        //                     sprite.alpha = 1;
        //                     sprite.tint = 0xFFFFFF;
        //                     sprite.scale.set(originalScale.x, originalScale.y);
        //                     sprite.rotation = 0;
        //                     sprite.texture = originalTexture;
        //                     sprite.x = originalX;
        //                     sprite.y = originalY;

        //                     // Reset zIndex to ensure it doesn't affect other symbols
        //                     sprite.zIndex = 0;

        //                     delete sprite._tickerRef;
        //                 }, 3000);
        //             }
        //         }
        //     }
        // }

function highlightWinningSymbols(apiReels, winningPositions) {
    // If no winning positions are passed, initialize it as an empty array
    winningPositions = winningPositions || [];

    console.log('------------Listing winning positions----------------');
    console.log(winningPositions);

    // Define a mapping of symbol names to z-index values
    const symbolZIndexMap = {
        "Treasure Chest": 80,
        "Wild": 100,
        "Scatter": 90,
        "Explorer": 60,
        "Compass": 60,
        "Binoculars": 70,
        "A": 50,
        "K": 50,
        "Q": 50,
        "J": 50
        // Add other symbols and their respective z-indexes here
    };

    // Loop through each reel
    for (let i = 0; i < numReels; i++) {
        const symbolContainer = reelSymbols[i]; // Container for current reel symbols

        // Loop through each symbol (child sprite) in this reel
        for (let j = 0; j < symbolContainer.children.length; j++) {
            const sprite = symbolContainer.children[j];             // Visual representation (sprite)
            const currentSymbolName = apiReels[i][j];               // Symbol name from API

            // Check if this symbol is in the list of winning positions
            const isWinning = winningPositions.some(pos =>
                pos.symbol === currentSymbolName && pos.reel === i && pos.row === j
            );

            console.log('------------nice--------------------');
            console.log(isWinning);

            if (isWinning) {
                // Reset visual styles
                sprite.filters = [];
                sprite.visible = true;
                sprite.alpha = 1;
                sprite.tint = 0xFFFFFF;
                sprite.rotation = 0;

                // Assign zIndex based on the symbol name from the mapping
                sprite.zIndex = symbolZIndexMap[currentSymbolName] || 0;  // Default to 0 if not found in map

                // Store original values for later reset
                const originalX = sprite.x;
                const originalY = sprite.y;
                const originalScale = { x: sprite.scale.x, y: sprite.scale.y };
                const originalTexture = sprite.texture;

                // Define the maximum scale increase (20%)
                const maxScaleX = originalScale.x * 1.0;
                const maxScaleY = originalScale.y * 1.0;

                let animationTicker;

                switch (currentSymbolName) {
                    case "Treasure Chest":
                        animationTicker = () => {
                            sprite.visible = Math.floor(Date.now() / 100) % 2 === 0;
                            sprite.scale.set(maxScaleX, maxScaleY);
                        };
                        break;


                    case "Wild":
                        const blinkTexture = PIXI.Texture.from("wild3.gif");
                        animationTicker = () => {
                            sprite.texture = Math.floor(Date.now() / 850) % 2 === 0
                                ? blinkTexture
                                : originalTexture;
                            sprite.scale.set(originalScale.x, originalScale.y);
                        };
                        break;

                    case "Scatter":
                        animationTicker = () => {
                            sprite.alpha = 0.5 
                            + 0.5 * Math.sin(Date.now() / 200);
                            sprite.scale.set(maxScaleX, maxScaleY);
                        };
                        break;

                    case "Explorer":
                        animationTicker = () => {
                            sprite.visible = Math.floor(Date.now() / 450) % 2 === 0;
                            sprite.scale.set(maxScaleX, maxScaleY);
                        };
                        break;

                    case "Compass":
                    case "Binoculars":
                        animationTicker = () => {
                            sprite.x = originalX + Math.sin(Date.now() / 80) * 4;
                            sprite.scale.set(maxScaleX, maxScaleY);
                        };
                        break;

                    case "A":
                    case "K":
                    case "Q":
                    case "J":
                        animationTicker = () => {
                            sprite.visible = Math.floor(Date.now() / 450) % 2 === 0;
                            sprite.scale.set(maxScaleX, maxScaleY);
                        };
                        break;

                    default:
                        const blinkTexture2 = PIXI.Texture.from("explorer_blink.gif");
                        animationTicker = () => {
                            sprite.texture = Math.floor(Date.now() / 300) % 2 === 0
                                ? blinkTexture2
                                : originalTexture;
                            sprite.scale.set(originalScale.x, originalScale.y);
                        };
                        
                        
                }

                // Start the animation
                const tickerRef = app.ticker.add(animationTicker);
                sprite._tickerRef = tickerRef;

                // Stop animation after 3 seconds and reset everything
                setTimeout(() => {
                    if (app.ticker && sprite._tickerRef) {
                        app.ticker.remove(sprite._tickerRef);
                    }

                    sprite.visible = true;
                    sprite.alpha = 1;
                    sprite.tint = 0xFFFFFF;
                    sprite.scale.set(originalScale.x, originalScale.y);
                    sprite.rotation = 0;
                    sprite.texture = originalTexture;
                    sprite.x = originalX;
                    sprite.y = originalY;

                    // Reset zIndex to ensure it doesn't affect other symbols
                    sprite.zIndex = 0;

                    delete sprite._tickerRef;
                }, 3000);
            }
        }
    }
}

// Add the following functions after the highlightWinningSymbols function:

// Function to remove bonus frame
function removeBonusFrame() {
    // This function is called when closing win animations
    // It removes any bonus frames or special effects that might be active
    const bonusFrames = document.querySelectorAll('.bonus-frame');
    bonusFrames.forEach(frame => {
        if (frame.parentNode) {
            frame.parentNode.removeChild(frame);
        }
    });
}

// Function to hide settings overlay
function hideSettingsOverlay() {
    settingsOverlay.style.display = 'none';
}

// Function to display settings overlay
function displaySettingsOverlay() {
    settingsOverlay.style.display = 'flex';
}

// Function to display info overlay
function displayInfoOverlay() {
    infoOverlay.style.display = 'flex';
}

// Function to hide info overlay
function hideInfoOverlay() {
    infoOverlay.style.display = 'none';
}

// Initialize the game
document.addEventListener('DOMContentLoaded', function() {
    // Create the reels
    createReels();
    
    // Set up event listeners
    spinButton.addEventListener('click', function() {
        if (!spinning && balance >= stake) {
            spin();
        }
    });
    
    autoPlayButton.addEventListener('click', function() {
        autoSpinOverlay.style.display = 'flex';
    });
    
    stakeButton.addEventListener('click', function() {
        stakeOverlay.style.display = 'flex';
    });
    
    // Settings button event listener
    settingsButton.addEventListener('click', function() {
        displaySettingsOverlay();
    });
    
    // Info button event listener
    infoButton.addEventListener('click', function() {
        displayInfoOverlay();
    });
    
    // Close info button event listener
    closeInfoButton.addEventListener('click', function() {
        hideInfoOverlay();
    });
    
    // Stake options
    stakeOptions.querySelectorAll('.option-button').forEach(button => {
        button.addEventListener('click', function() {
            stakeOptions.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            selectedStake = parseFloat(this.getAttribute('data-value'));
        });
    });
    
    // Auto spin options
    autoSpinOptions.querySelectorAll('.option-button').forEach(button => {
        button.addEventListener('click', function() {
            autoSpinOptions.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
            this.classList.add('selected');
            selectedAutoSpins = parseInt(this.getAttribute('data-value'));
        });
    });
    
    // Confirm stake button
    confirmStakeButton.addEventListener('click', function() {
        stake = selectedStake;
        currentStakeElement.textContent = stake.toFixed(1);
        stakeOverlay.style.display = 'none';
    });
    
    // Cancel stake button
    cancelStakeButton.addEventListener('click', function() {
        stakeOverlay.style.display = 'none';
    });
    
    // Confirm auto spin button
    confirmAutoSpinButton.addEventListener('click', function() {
        autoSpins = selectedAutoSpins;
        if (autoSpins > 0) {
            remainingAutoSpins.textContent = autoSpins > 0 ? autoSpins : '';
            if (!spinning && balance >= stake) {
                spin();
            }
        }
        autoSpinOverlay.style.display = 'none';
    });
    
    // Cancel auto spin button
    cancelAutoSpinButton.addEventListener('click', function() {
        autoSpinOverlay.style.display = 'none';
    });
    
    // Background music option
    backgroundMusicOption.addEventListener('click', function() {
        backgroundMusicEnabled = !backgroundMusicEnabled;
        if (backgroundMusicEnabled) {
            backgroundMusicIcon.innerHTML = '<i class="fa fa-volume-up" style="color: #e4d594;font-size: 1.4rem;"></i>';
            backgroundMusic.play().catch(e => console.log("Audio play failed:", e));
        } else {
            backgroundMusicIcon.innerHTML = '<i class="fa fa-volume-mute" style="color: #e4d594;font-size: 1.4rem;"></i>';
            backgroundMusic.pause();
        }
    });
    
    // Update the balance display
    updateBalance();
});

// Function to update the balance display
function updateBalance() {
    balanceText.textContent = balance.toFixed(2);
}

// Function to spin the reels
function spin() {
    if (spinning) return;
    
    spinning = true;
    
    // Deduct the stake from the balance
    balance -= stake;
    updateBalance();
    
    // Play spin sound
    if (soundEffectsEnabled) {
        spinSound.currentTime = 0;
        spinSound.play().catch(e => console.log("Audio play failed:", e));
    }
    
    // Reset win display
    document.getElementById('update_winnings').textContent = '0.00';
    
    // Generate a mock API result (in a real game, this would come from the server)
    const apiResult = generateMockResult();
    
    // Start the spin animation
    spinAnimation(() => {
        // Animation complete callback
        
        // Update the balance with any winnings
        if (apiResult.win_amount > 0) {
            balance += apiResult.win_amount;
            updateBalance();
            
            // Display the win amount
            document.getElementById('update_winnings').textContent = apiResult.win_amount.toFixed(2);
            
            // Play win sound
            if (soundEffectsEnabled) {
                winSound.currentTime = 0;
                winSound.play().catch(e => console.log("Audio play failed:", e));
            }
            
            // Show win animation for big wins
            if (apiResult.win_amount >= 10) {
                showWinAnimation(apiResult.win_amount);
            }
        }
        
        // Check for free spins
        if (apiResult.free_spins > 0 && !isFreeSpinMode) {
            startFreeSpins(apiResult.free_spins, apiResult.bonus_multiplier);
        } else {
            // Continue auto spins if active
            if (autoSpins > 0) {
                autoSpins--;
                remainingAutoSpins.textContent = autoSpins > 0 ? autoSpins : '';
                
                if (autoSpins > 0 && balance >= stake) {
                    setTimeout(() => {
                        spin();
                    }, 1000);
                }
            }
        }
    }, apiResult);
}

// Function to start free spins
function startFreeSpins(spins, multiplier) {
    isFreeSpinMode = true;
    freeSpinCount = spins;
    bonusMultiplier = multiplier;
    originalBetAmount = stake;
    
    // Update the free spins display
    document.getElementById('normalspins_display').style.display = 'none';
    document.getElementById('freespins_display').style.display = 'flex';
    document.getElementById('remaining_fs_holder').textContent = freeSpinCount;
    document.getElementById('total_fs_holder').textContent = spins;
    
    // Show the free spins indicator
    freeSpinsIndicator.style.display = 'block';
    freeSpinsCountElement.textContent = freeSpinCount;
    bonusMultiplierElement.textContent = bonusMultiplier;
    
    // Start the first free spin after a delay
    setTimeout(() => {
        spinFreeSpin();
    }, 2000);
}

// Function to spin during free spins
function spinFreeSpin() {
    if (spinning) return;
    
    spinning = true;
    
    // Play spin sound
    if (soundEffectsEnabled) {
        spinSound.currentTime = 0;
        spinSound.play().catch(e => console.log("Audio play failed:", e));
    }
    
    // Reset win display
    document.getElementById('update_winnings').textContent = '0.00';
    
    // Generate a mock API result for free spins (higher win chance)
    const apiResult = generateMockFreeSpinResult();
    
    // Start the spin animation
    spinAnimation(() => {
        // Animation complete callback
        
        // Update the free spins count
        freeSpinCount--;
        document.getElementById('remaining_fs_holder').textContent = freeSpinCount;
        freeSpinsCountElement.textContent = freeSpinCount;
        
        // Apply bonus multiplier to any win
        if (apiResult.win_amount > 0) {
            const multipliedWin = apiResult.win_amount * bonusMultiplier;
            balance += multipliedWin;
            updateBalance();
            
            // Display the win amount
            document.getElementById('update_winnings').textContent = multipliedWin.toFixed(2);
            
            // Play win sound
            if (soundEffectsEnabled) {
                winSound.currentTime = 0;
                winSound.play().catch(e => console.log("Audio play failed:", e));
            }
        }
        
        // Check if we have more free spins
        if (freeSpinCount > 0) {
            // Continue with the next free spin after a delay
            setTimeout(() => {
                spinFreeSpin();
            }, 1000);
        } else {
            // End of free spins
            endFreeSpins();
        }
    }, apiResult);
}

// Function to end free spins
function endFreeSpins() {
    isFreeSpinMode = false;
    
    // Reset the display
    document.getElementById('normalspins_display').style.display = 'flex';
    document.getElementById('freespins_display').style.display = 'none';
    freeSpinsIndicator.style.display = 'none';
    
    // Show a summary of free spins winnings
    // This would typically be implemented with a special animation or overlay
}

// Function to generate a mock result (simulating server response)
function generateMockResult() {
    // Generate random reels
    const reels = [];
    for (let i = 0; i < numReels; i++) {
        const reelSymbols = [];
        for (let j = 0; j < numRows; j++) {
            const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
            reelSymbols.push(randomSymbol.name);
        }
        reels.push(reelSymbols);
    }
    
    // Determine if there's a win (simplified logic)
    const winAmount = Math.random() < 0.3 ? Math.floor(Math.random() * 50) + 1 : 0;
    
    // Generate winning positions (simplified)
    const winningPositions = [];
    if (winAmount > 0) {
        // Just mark some random positions as winning for demonstration
        const winningSymbol = reels[0][Math.floor(Math.random() * numRows)];
        for (let i = 0; i < numReels; i++) {
            for (let j = 0; j < numRows; j++) {
                if (reels[i][j] === winningSymbol || Math.random() < 0.2) {
                    winningPositions.push({
                        reel: i,
                        row: j,
                        symbol: reels[i][j]
                    });
                }
            }
        }
    }
    
    // Check for free spins (simplified)
    const freeSpins = Math.random() < 0.05 ? 13 : 0;
    const bonusMultiplier = freeSpins > 0 ? [3, 6, 12, 24, 36, 72][Math.floor(Math.random() * 6)] : 0;
    
    return {
        reels,
        win_amount: winAmount,
        winning_positions: winningPositions,
        free_spins: freeSpins,
        bonus_multiplier: bonusMultiplier
    };
}

// Function to generate a mock result for free spins (higher win chance)
function generateMockFreeSpinResult() {
    // Similar to generateMockResult but with higher win probability
    const result = generateMockResult();
    result.win_amount = Math.random() < 0.6 ? Math.floor(Math.random() * 100) + 10 : 0;
    return result;
}

// Fix for the displaySettingsOverlay2 function
function displaySettingsOverlay2() {
    displaySettingsOverlay();
}

</script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            overflow: hidden;
        }
        
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        #slot-machine {
            position: relative;
            width: 800px;
            height: 600px;
            background-color: #2a2a2a;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        #reels-container {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 600px;
            height: 300px;
            display: flex;
            justify-content: space-between;
            perspective: 1000px;
        }
        
        .reel {
            position: relative;
            width: 110px;
            height: 300px;
            background-color: #1a1a1a;
            overflow: hidden;
            border: 2px solid #444;
            border-radius: 5px;
        }
        
        .symbol {
            position: absolute;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            transition: transform 0.1s ease-in-out;
        }
        
        .symbol.winning {
            animation: pulse 0.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        #controls {
            position: absolute;
            bottom: 50px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        #spin-button {
            background-color: #e63946;
            color: white;
            font-weight: bold;
            padding: 15px 30px;
            font-size: 24px;
        }
        
        #spin-button:hover {
            background-color: #ff4d5e;
            transform: scale(1.05);
        }
        
        #spin-button:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: scale(1);
        }
        
        .control-button {
            background-color: #333;
            color: white;
        }
        
        .control-button:hover {
            background-color: #444;
        }
        
        #balance-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        
        #win-display {
            position: absolute;
            top: 50px;
            right: 20px;
            font-size: 20px;
            color: #ffd700;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #win-display.show {
            opacity: 1;
        }
        
        #bet-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #bet-amount {
            font-size: 20px;
            font-weight: bold;
        }
        
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        
        .overlay-content {
            background-color: #2a2a2a;
            padding: 30px;
            border-radius: 10px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }
        
        #win-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        #win-animation.show {
            opacity: 1;
        }
        
        .coin {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #ffd700;
            border-radius: 50%;
            opacity: 0.8;
        }
        
        #free-spins-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        #free-spins-indicator.show {
            opacity: 1;
        }
        
        #bonus-frame {
            position: absolute;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            width: 620px;
            height: 320px;
            border: 10px solid #ffd700;
            border-radius: 15px;
            box-shadow: 0 0 20px #ffd700;
            opacity: 0;
            pointer-events: none;
            z-index: 40;
        }
        
        #bonus-frame.show {
            opacity: 1;
            animation: glow 1.5s infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px #ffd700; }
            to { box-shadow: 0 0 40px #ffd700; }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="slot-machine">
            <div id="reels-container">
                <div class="reel" id="reel1"></div>
                <div class="reel" id="reel2"></div>
                <div class="reel" id="reel3"></div>
                <div class="reel" id="reel4"></div>
                <div class="reel" id="reel5"></div>
            </div>
            
            <div id="controls">
                <button id="auto-play-button" class="control-button">Auto Play</button>
                <button id="bet-decrease" class="control-button">-</button>
                <span id="bet-amount">1.00</span>
                <button id="bet-increase" class="control-button">+</button>
                <button id="spin-button">SPIN</button>
                <button id="max-bet-button" class="control-button">Max Bet</button>
                <button id="settings-button" class="control-button"></button>
                <button id="info-button" class="control-button"></button>
            </div>
            
            <div id="balance-display">Balance: $1000.00</div>
            <div id="win-display">Win: $0.00</div>
            <div id="free-spins-indicator">Free Spins: 0</div>
            <div id="bonus-frame"></div>
            
            <div id="win-animation"></div>
        </div>
        
        <div id="settings-overlay" class="overlay">
            <div class="overlay-content">
                <h2>Settings</h2>
                <div>
                    <label for="sound-toggle">Sound:</label>
                    <input type="checkbox" id="sound-toggle" checked>
                </div>
                <div>
                    <label for="music-toggle">Music:</label>
                    <input type="checkbox" id="music-toggle" checked>
                </div>
                <div>
                    <label for="turbo-toggle">Turbo Mode:</label>
                    <input type="checkbox" id="turbo-toggle">
                </div>
                <button id="close-settings" class="close-button"></button>
            </div>
        </div>
        
        <div id="info-overlay" class="overlay">
            <div class="overlay-content">
                <h2>Paytable</h2>
                <p>Match 3 or more symbols on a payline to win!</p>
                <h3>Symbol Values (for 5 of a kind):</h3>
                <ul>
                    <li> Wizard: 500x bet</li>
                    <li> Dragon: 300x bet</li>
                    <li> Spellbook: 200x bet</li>
                    <li> Crystal Ball: 150x bet</li>
                    <li> Potion: 100x bet</li>
                    <li> Elixir: 80x bet</li>
                    <li> Wand: 50x bet</li>
                    <li> Amulet: 30x bet</li>
                    <li> Star: 20x bet</li>
                    <li> Moon: 10x bet</li>
                </ul>
                <h3>Special Symbols:</h3>
                <ul>
                    <li> Wild: Substitutes for any symbol except Scatter</li>
                    <li> Scatter: 3 or more trigger Free Spins</li>
                </ul>
                <button id="close-info" class="close-button"></button>
            </div>
        </div>
    </div>

    <script>
        // Game configuration
        const config = {
            reels: 5,
            rows: 3,
            symbolsPerReel: 10,
            spinDuration: 2000,
            spinningSpeed: 30,
            stopDelay: 300,
            symbolHeight: 100,
            balance: 1000,
            betAmount: 1,
            autoPlayCount: 0,
            freeSpinsCount: 0,
            isTurboMode: false,
            soundEnabled: true,
            musicEnabled: true
        };

        // Symbol definitions
        const symbols = [
            { id: 'wizard', value: '', weight: 1, payout: [0, 0, 5, 20, 500] },
            { id: 'dragon', value: '', weight: 2, payout: [0, 0, 4, 15, 300] },
            { id: 'spellbook', value: '', weight: 3, payout: [0, 0, 3, 10, 200] },
            { id: 'crystal', value: '', weight: 4, payout: [0, 0, 3, 8, 150] },
            { id: 'potion', value: '', weight: 5, payout: [0, 0, 2, 5, 100] },
            { id: 'elixir', value: '', weight: 6, payout: [0, 0, 2, 4, 80] },
            { id: 'wand', value: '', weight: 7, payout: [0, 0, 1, 3, 50] },
            { id: 'amulet', value: '', weight: 8, payout: [0, 0, 1, 2, 30] },
            { id: 'star', value: '', weight: 9, payout: [0, 0, 0.5, 1, 20] },
            { id: 'moon', value: '', weight: 10, payout: [0, 0, 0.5, 1, 10] },
            { id: 'wild', value: '', weight: 1, isWild: true, payout: [0, 0, 10, 25, 500] },
            { id: 'scatter', value: '', weight: 1, isScatter: true, payout: [0, 0, 5, 10, 50] }
        ];

        // Game state
        let gameState = {
            isSpinning: false,
            reelSymbols: [],
            visibleSymbols: [],
            spinResults: null,
            winAmount: 0,
            isAutoPlaying: false,
            isFreeSpinMode: false
        };

        // DOM elements
        const reelsContainer = document.getElementById('reels-container');
        const spinButton = document.getElementById('spin-button');
        const autoPlayButton = document.getElementById('auto-play-button');
        const betDecreaseButton = document.getElementById('bet-decrease');
        const betIncreaseButton = document.getElementById('bet-increase');
        const maxBetButton = document.getElementById('max-bet-button');
        const settingsButton = document.getElementById('settings-button');
        const infoButton = document.getElementById('info-button');
        const balanceDisplay = document.getElementById('balance-display');
        const winDisplay = document.getElementById('win-display');
        const betAmountDisplay = document.getElementById('bet-amount');
        const freeSpinsIndicator = document.getElementById('free-spins-indicator');
        const bonusFrame = document.getElementById('bonus-frame');
        const winAnimation = document.getElementById('win-animation');
        const settingsOverlay = document.getElementById('settings-overlay');
        const infoOverlay = document.getElementById('info-overlay');
        const closeSettingsButton = document.getElementById('close-settings');
        const closeInfoButton = document.getElementById('close-info');
        const soundToggle = document.getElementById('sound-toggle');
        const musicToggle = document.getElementById('music-toggle');
        const turboToggle = document.getElementById('turbo-toggle');

        // Initialize the game
        function initGame() {
            // Create initial symbols for each reel
            for (let i = 0; i < config.reels; i++) {
                const reelElement = document.getElementById(`reel${i + 1}`);
                gameState.reelSymbols[i] = [];
                
                // Create symbols for each reel (more than visible to allow for flowing animation)
                for (let j = 0; j < config.symbolsPerReel; j++) {
                    const symbolElement = createSymbolElement(getRandomSymbol(), j);
                    reelElement.appendChild(symbolElement);
                    gameState.reelSymbols[i].push(symbolElement);
                }
            }
            
            // Initialize visible symbols (3 rows per reel)
            updateVisibleSymbols();
            
            // Set up event listeners
            spinButton.addEventListener('click', spin);
            autoPlayButton.addEventListener('click', toggleAutoPlay);
            betDecreaseButton.addEventListener('click', decreaseBet);
            betIncreaseButton.addEventListener('click', increaseBet);
            maxBetButton.addEventListener('click', setMaxBet);
            settingsButton.addEventListener('click', displaySettingsOverlay);
            infoButton.addEventListener('click', displayInfoOverlay);
            closeSettingsButton.addEventListener('click', hideSettingsOverlay);
            closeInfoButton.addEventListener('click', hideInfoOverlay);
            soundToggle.addEventListener('change', toggleSound);
            musicToggle.addEventListener('change', toggleMusic);
            turboToggle.addEventListener('change', toggleTurboMode);
            
            // Update displays
            updateBalanceDisplay();
            updateBetDisplay();
        }

        // Create a symbol element
        function createSymbolElement(symbol, position) {
            const symbolElement = document.createElement('div');
            symbolElement.className = 'symbol';
            symbolElement.textContent = symbol.value;
            symbolElement.dataset.symbolId = symbol.id;
            symbolElement.style.top = `${position * config.symbolHeight}px`;
            return symbolElement;
        }

        // Get a random symbol based on weights
        function getRandomSymbol() {
            const totalWeight = symbols.reduce((sum, symbol) => sum + symbol.weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const symbol of symbols) {
                random -= symbol.weight;
                if (random <= 0) {
                    return symbol;
                }
            }
            
            return symbols[0]; // Fallback
        }

        // Update which symbols are currently visible
        function updateVisibleSymbols() {
            gameState.visibleSymbols = [];
            
            for (let i = 0; i < config.reels; i++) {
                gameState.visibleSymbols[i] = [];
                
                // Get the 3 visible symbols for each reel
                for (let j = 0; j < config.rows; j++) {
                    const symbolIndex = j % config.symbolsPerReel;
                    gameState.visibleSymbols[i][j] = gameState.reelSymbols[i][symbolIndex];
                }
            }
        }

        // Main spin function
        function spin() {
            if (gameState.isSpinning) return;
            
            // Check if we have enough balance
            if (config.balance < config.betAmount && !gameState.isFreeSpinMode) {
                alert("Insufficient balance!");
                return;
            }
            
            // Deduct bet amount if not in free spin mode
            if (!gameState.isFreeSpinMode) {
                config.balance -= config.betAmount;
                updateBalanceDisplay();
            } else {
                config.freeSpinsCount--;
                updateFreeSpinsIndicator();
            }
            
            // Reset win display
            winDisplay.textContent = "Win: $0.00";
            winDisplay.classList.remove('show');
            
            // Disable spin button
            gameState.isSpinning = true;
            spinButton.disabled = true;
            
            // Generate spin result
            if (gameState.isFreeSpinMode) {
                gameState.spinResults = generateMockFreeSpinResult();
            } else {
                gameState.spinResults = generateMockResult();
            }
            
            // Start the spinning animation
            spinAnimation();
        }

        // Spin animation
        function spinAnimation() {
            // Reset any previous winning highlights
            document.querySelectorAll('.symbol.winning').forEach(el => {
                el.classList.remove('winning');
            });
            
            // Remove bonus frame if it exists
            removeBonusFrame();
            
            // Create a flowing animation from top to bottom
            const reelStopTimes = [];
            const symbolPositions = Array(config.reels).fill(0);
            const spinningIntervals = [];
            
            // Calculate stop times for each reel (progressive stopping)
            for (let i = 0; i < config.reels; i++) {
                const spinDuration = config.isTurboMode ? config.spinDuration / 2 : config.spinDuration;
                reelStopTimes[i] = spinDuration + (i * config.stopDelay);
            }
            
            // Start spinning each reel
            for (let i = 0; i < config.reels; i++) {
                const reelElement = document.getElementById(`reel${i + 1}`);
                const reelSymbols = gameState.reelSymbols[i];
                
                // Create spinning interval for this reel
                spinningIntervals[i] = setInterval(() => {
                    // Move all symbols down
                    for (let j = 0; j < reelSymbols.length; j++) {
                        const symbolElement = reelSymbols[j];
                        let currentTop = parseInt(symbolElement.style.top);
                        currentTop += config.spinningSpeed;
                        
                        // If symbol goes below the reel, move it to the top
                        if (currentTop >= config.symbolHeight * config.symbolsPerReel) {
                            currentTop = -config.symbolHeight;
                            
                            // If this reel is about to stop, set the correct symbol
                            if (Date.now() > reelStopTimes[i] - 1000) {
                                const resultIndex = symbolPositions[i] % config.rows;
                                const resultSymbol = gameState.spinResults.symbols[i][resultIndex];
                                const symbol = symbols.find(s => s.id === resultSymbol);
                                symbolElement.textContent = symbol.value;
                                symbolElement.dataset.symbolId = symbol.id;
                            } else {
                                // Otherwise, set a random symbol
                                const randomSymbol = getRandomSymbol();
                                symbolElement.textContent = randomSymbol.value;
                                symbolElement.dataset.symbolId = randomSymbol.id;
                            }
                            
                            symbolPositions[i]++;
                        }
                        
                        symbolElement.style.top = `${currentTop}px`;
                    }
                }, 16); // ~60fps
                
                // Set timeout to stop this reel
                setTimeout(() => {
                    clearInterval(spinningIntervals[i]);
                    
                    // Ensure final positions are correct
                    for (let j = 0; j < config.rows; j++) {
                        const resultSymbol = gameState.spinResults.symbols[i][j];
                        const symbol = symbols.find(s => s.id === resultSymbol);
                        const symbolElement = reelSymbols[j];
                        
                        symbolElement.textContent = symbol.value;
                        symbolElement.dataset.symbolId = symbol.id;
                        symbolElement.style.top = `${j * config.symbolHeight}px`;
                    }
                    
                    // Play stop sound
                    if (config.soundEnabled) {
                        playSound('reel-stop');
                    }
                    
                    // If this is the last reel, handle the results
                    if (i === config.reels - 1) {
                        setTimeout(() => {
                            handleSpinResults();
                        }, 500);
                    }
                }, reelStopTimes[i]);
            }
        }

        // Handle the results of a spin
        function handleSpinResults() {
            gameState.isSpinning = false;
            spinButton.disabled = false;
            
            // Update visible symbols
            updateVisibleSymbols();
            
            // Calculate win amount
            gameState.winAmount = gameState.spinResults.totalWin * config.betAmount;
            
            // Update balance
            config.balance += gameState.winAmount;
            updateBalanceDisplay();
            
            // Show win amount if there's a win
            if (gameState.winAmount > 0) {
                winDisplay.textContent = `Win: $${gameState.winAmount.toFixed(2)}`;
                winDisplay.classList.add('show');
                
                // Highlight winning symbols
                highlightWinningSymbols();
                
                // Show win animation for big wins
                if (gameState.winAmount >= config.betAmount * 10) {
                    showWinAnimation();
                }
            }
            
            // Check for free spins trigger
            if (gameState.spinResults.freeSpins > 0 && !gameState.isFreeSpinMode) {
                config.freeSpinsCount = gameState.spinResults.freeSpins;
                setTimeout(() => {
                    startFreeSpins();
                }, 1000);
            } else if (gameState.isFreeSpinMode && config.freeSpinsCount === 0) {
                // End free spins if count reaches 0
                setTimeout(() => {
                    endFreeSpins();
                }, 1000);
            } else if (gameState.isAutoPlaying || gameState.isFreeSpinMode) {
                // Continue auto play or free spins
                setTimeout(() => {
                    spin();
                }, 1000);
            }
        }

        // Highlight winning symbols
        function highlightWinningSymbols() {
            if (!gameState.spinResults.winningLines) return;
            
            for (const line of gameState.spinResults.winningLines) {
                for (const position of line.positions) {
                    const [reelIndex, rowIndex] = position;
                    const symbolElement = gameState.visibleSymbols[reelIndex][rowIndex];
                    symbolElement.classList.add('winning');
                    
                    // Add specific animations based on symbol type
                    const symbolId = symbolElement.dataset.symbolId;
                    
                    switch (symbolId) {
                        case 'wild':
                            symbolElement.style.animation = 'pulse 0.5s infinite alternate';
                            break;
                        case 'scatter':
                            symbolElement.style.animation = 'glow 1s infinite alternate';
                            break;
                        case 'wizard':
                        case 'dragon':
                            symbolElement.style.animation = 'pulse 0.7s infinite alternate';
                            break;
                        default:
                            symbolElement.style.animation = 'pulse 0.5s infinite alternate';
                    }
                }
            }
            
            // Play win sound
            if (config.soundEnabled) {
                playSound('win');
            }
        }

        // Show win animation
        function showWinAnimation() {
            winAnimation.innerHTML = '';
            winAnimation.classList.add('show');
            
            // Create coins
            const coinCount = Math.min(100, Math.floor(gameState.winAmount / config.betAmount));
            
            for (let i = 0; i < coinCount; i++) {
                setTimeout(() => {
                    createCoin();
                }, i * 50);
            }
            
            // Play big win sound
            if (config.soundEnabled) {
                playSound('big-win');
            }
            
            // Hide animation after a delay
            setTimeout(() => {
                closeWinAnimation();
            }, 5000);
        }

        // Create a coin for the win animation
        function createCoin() {
            const coin = document.createElement('div');
            coin.className = 'coin';
            
            // Random position
            const left = Math.random() * 100;
            const top = -50;
            
            coin.style.left = `${left}%`;
            coin.style.top = `${top}px`;
            
            // Random animation
            const duration = 1 + Math.random() * 2;
            const delay = Math.random();
            const finalTop = 100 + Math.random() * 20;
            
            coin.style.animation = `fall ${duration}s ${delay}s forwards`;
            coin.style.animationTimingFunction = 'ease-in';
            
            // Add keyframe animation dynamically
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    to {
                        transform: translateY(${finalTop}vh) rotate(${Math.random() * 720 - 360}deg);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
            
            winAnimation.appendChild(coin);
            
            // Remove coin after animation
            setTimeout(() => {
                if (coin.parentNode === winAnimation) {
                    winAnimation.removeChild(coin);
                }
                document.head.removeChild(style);
            }, (duration + delay) * 1000);
        }

        // Close win animation
        function closeWinAnimation() {
            winAnimation.classList.remove('show');
            setTimeout(() => {
                winAnimation.innerHTML = '';
            }, 500);
        }

        // Start free spins
        function startFreeSpins() {
            gameState.isFreeSpinMode = true;
            updateFreeSpinsIndicator();
            
            // Show bonus frame
            bonusFrame.classList.add('show');
            
            // Play free spins sound
            if (config.soundEnabled) {
                playSound('free-spins');
            }
            
            // Start first free spin
            setTimeout(() => {
                spin();
            }, 1000);
        }

        // End free spins
        function endFreeSpins() {
            gameState.isFreeSpinMode = false;
            freeSpinsIndicator.classList.remove('show');
            
            // Remove bonus frame
            removeBonusFrame();
            
            // Play end free spins sound
            if (config.soundEnabled) {
                playSound('free-spins-end');
            }
            
            // Continue auto play if active
            if (gameState.isAutoPlaying) {
                setTimeout(() => {
                    spin();
                }, 1000);
            }
        }

        // Remove bonus frame
        function removeBonusFrame() {
            bonusFrame.classList.remove('show');
        }

        // Toggle auto play
        function toggleAutoPlay() {
            gameState.isAutoPlaying = !gameState.isAutoPlaying;
            
            if (gameState.isAutoPlaying) {
                autoPlayButton.textContent = 'Stop Auto';
                autoPlayButton.style.backgroundColor = '#e63946';
                
                // Start spinning if not already spinning
                if (!gameState.isSpinning) {
                    spin();
                }
            } else {
                autoPlayButton.textContent = 'Auto Play';
                autoPlayButton.style.backgroundColor = '#333';
            }
        }

        // Decrease bet amount
        function decreaseBet() {
            if (gameState.isSpinning) return;
            
            config.betAmount = Math.max(0.1, config.betAmount - 0.1);
            updateBetDisplay();
        }

        // Increase bet amount
        function increaseBet() {
            if (gameState.isSpinning) return;
            
            config.betAmount = Math.min(100, config.betAmount + 0.1);
            updateBetDisplay();
        }

        // Set max bet
        function setMaxBet() {
            if (gameState.isSpinning) return;
            
            config.betAmount = Math.min(100, Math.floor(config.balance / 10) * 10);
            updateBetDisplay();
        }

        // Update balance display
        function updateBalanceDisplay() {
            balanceDisplay.textContent = `Balance: $${config.balance.toFixed(2)}`;
        }

        // Update bet display
        function updateBetDisplay() {
            betAmountDisplay.textContent = config.betAmount.toFixed(2);
        }

        // Update free spins indicator
        function updateFreeSpinsIndicator() {
            if (config.freeSpinsCount > 0) {
                freeSpinsIndicator.textContent = `Free Spins: ${config.freeSpinsCount}`;
                freeSpinsIndicator.classList.add('show');
            } else {
                freeSpinsIndicator.classList.remove('show');
            }
        }

        // Display settings overlay
        function displaySettingsOverlay() {
            settingsOverlay.classList.add('show');
        }

        // Hide settings overlay
        function hideSettingsOverlay() {
            settingsOverlay.classList.remove('show');
        }

        // Display info overlay
        function displayInfoOverlay() {
            infoOverlay.classList.add('show');
        }

        // Hide info overlay
        function hideInfoOverlay() {
            infoOverlay.classList.remove('show');
        }

        // Toggle sound
        function toggleSound() {
            config.soundEnabled = soundToggle.checked;
        }

        // Toggle music
        function toggleMusic() {
            config.musicEnabled = musicToggle.checked;
            
            if (config.musicEnabled) {
                playBackgroundMusic();
            } else {
                stopBackgroundMusic();
            }
        }

        // Toggle turbo mode
        function toggleTurboMode() {
            config.isTurboMode = turboToggle.checked;
        }

        // Play sound effect
        function playSound(soundType) {
            if (!config.soundEnabled) return;
            
            // In a real implementation, you would play actual sound files here
            console.log(`Playing sound: ${soundType}`);
        }

        // Play background music
        function playBackgroundMusic() {
            if (!config.musicEnabled) return;
            
            // In a real implementation, you would play actual music here
            console.log('Playing background music');
        }

        // Stop background music
        function stopBackgroundMusic() {
            // In a real implementation, you would stop the music here
            console.log('Stopping background music');
        }

        // Generate mock spin result
        function generateMockResult() {
            // In a real implementation, this would come from a server
            const result = {
                symbols: [],
                totalWin: 0,
                winningLines: [],
                freeSpins: 0
            };
            
            // Generate random symbols for each position
            for (let i = 0; i < config.reels; i++) {
                result.symbols[i] = [];
                for (let j = 0; j < config.rows; j++) {
                    const randomSymbol = getRandomSymbol();
                    result.symbols[i][j] = randomSymbol.id;
                }
            }
            
            // Check for winning lines (simplified)
            const middleRow = [];
            for (let i = 0; i < config.reels; i++) {
                middleRow.push(result.symbols[i][1]);
            }
            
            // Check for 3+ matching symbols in the middle row
            let currentSymbol = middleRow[0];
            let count = 1;
            
            for (let i = 1; i < middleRow.length; i++) {
                if (middleRow[i] === currentSymbol || 
                    middleRow[i] === 'wild' || 
                    (currentSymbol === 'wild' && i === 1)) {
                    count++;
                } else {
                    break;
                }
            }
            
            // If we have a win, calculate the amount
            if (count >= 3) {
                const winningSymbol = currentSymbol === 'wild' && count === 1 ? middleRow[1] : currentSymbol;
                const symbol = symbols.find(s => s.id === winningSymbol);
                
                if (symbol) {
                    const positions = [];
                    for (let i = 0; i < count; i++) {
                        positions.push([i, 1]); // [reel, row]
                    }
                    
                    result.winningLines.push({
                        symbol: winningSymbol,
                        count: count,
                        payout: symbol.payout[count - 1],
                        positions: positions
                    });
                    
                    result.totalWin += symbol.payout[count - 1];
                }
            }
            
            // Check for scatters (simplified)
            const scatterCount = result.symbols.flat().filter(s => s === 'scatter').length;
            
            if (scatterCount >= 3) {
                result.freeSpins = 10;
                
                // Add scatter win
                const scatterSymbol = symbols.find(s => s.id === 'scatter');
                result.totalWin += scatterSymbol.payout[scatterCount - 1];
                
                // Add scatter positions
                const positions = [];
                for (let i = 0; i < config.reels; i++) {
                    for (let j = 0; j < config.rows; j++) {
                        if (result.symbols[i][j] === 'scatter') {
                            positions.push([i, j]);
                        }
                    }
                }
                
                result.winningLines.push({
                    symbol: 'scatter',
                    count: scatterCount,
                    payout: scatterSymbol.payout[scatterCount - 1],
                    positions: positions
                });
            }
            
            return result;
        }

        // Generate mock free spin result (higher win chance)
        function generateMockFreeSpinResult() {
            const result = generateMockResult();
            
            // Increase win chance in free spins
            if (Math.random() < 0.7 && result.totalWin === 0) {
                // Force a win by adding wilds
                const wildPositions = [];
                for (let i = 0; i < 3; i++) {
                    result.symbols[i][1] = 'wild';
                    wildPositions.push([i, 1]);
                }
                
                // Add a winning line
                const wildSymbol = symbols.find(s => s.id === 'wild');
                result.winningLines.push({
                    symbol: 'wild',
                    count: 3,
                    payout: wildSymbol.payout[2],
                    positions: wildPositions
                });
                
                result.totalWin += wildSymbol.payout[2];
            }
            
            return result;
        }

        // Initialize the game when the page loads
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
